.root {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  /* Base app surface is driven by design-system tokens (themes via data-theme). */
  background: var(--ds-page-bg);
  color: var(--ds-text-1);
  font-family: var(--ds-font-sans);
}

.canvas {
  position: absolute;
  inset: 0;
  z-index: 1;
}

.canvas-fx {
  pointer-events: none;
  z-index: 3;
}

.root[data-webdriver='1'] .canvas-fx {
  /* Keep Playwright screenshots stable (no animated FX layer in captures). */
  z-index: 0;
}

/* Low quality OR no-GPU: disable expensive backdrop blurs (big perf win in Chrome). */
.root[data-quality='low'] .drag-preview,
.root[data-quality='low'] .ds-ov-tooltip,
.root[data-quality='low'] .ds-ov-node-card,
.root[data-quality='low'] .ds-ov-message,
.root[data-quality='low'] .ds-ov-surface,

.root[data-gpu='0'] .drag-preview,
.root[data-gpu='0'] .ds-ov-tooltip,
.root[data-gpu='0'] .ds-ov-node-card,
.root[data-gpu='0'] .ds-ov-message,
.root[data-gpu='0'] .ds-ov-surface {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
}

.drag-preview {
  position: absolute;
  left: 0;
  top: 0;
  z-index: 6;
  display: none;
  pointer-events: none;
  will-change: transform;
  transform: translate3d(0, 0, 0);
  border: 1px solid rgba(255, 255, 255, 0.25);
  backdrop-filter: blur(6px);
}

.mono {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New";
}
.floating-layer {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 50;
  /* Isolate layout/paint of transient labels from the rest of the UI. */
  contain: layout paint;
}

.labels-layer {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 45;
  contain: layout paint;
}

.node-label {
  position: absolute;
  left: 0;
  top: 0;
  will-change: transform;
}

.node-label-inner {
  /* Centered label, placed below the node via computed world offset (no frame). */
  transform: translate3d(-50%, -50%, 0) scale(var(--overlay-scale, 1));
  font-size: 12px;
  font-weight: 650;
  padding: 1px 6px;
  border: none;
  background: transparent;
  text-align: center;
  text-shadow:
    0 0 14px rgba(0, 0, 0, 0.92),
    0 0 10px rgba(148, 163, 184, 0.42);
  filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.18));
  white-space: nowrap;
}

.floating-label {
  position: absolute;
  left: 0;
  top: 0;
  pointer-events: none;
}

.floating-label-inner {
  display: inline-block;
  font-size: 14px;
  font-weight: 700;
  text-shadow: 0 0 10px currentColor; /* Default glow */
  animation: floatUpFade 2.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  /* Keep centering constant; animate only a pixel offset for smooth motion. */
  transform: translate3d(-50%, -50%, 0) scale(var(--overlay-scale, 1)) translate3d(0, 0, 0);
  will-change: transform, opacity;
  backface-visibility: hidden;
  white-space: pre-line;
  text-align: center;
  line-height: 1.05;
  font-variant-numeric: tabular-nums;
}

/* Improve contrast over nodes/background, but keep WebDriver screenshots stable. */
.root:not([data-webdriver='1']) .floating-label-inner {
  /* Airy by default: subtle dark halo + neon glow. */
  text-shadow:
    0 0 12px rgba(0, 0, 0, 0.85),
    0 0 12px currentColor;
  filter: drop-shadow(0 10px 22px rgba(0, 0, 0, 0.2));
  transition: filter 120ms linear;
}

/* Only boost readability when the label is likely to merge with a node behind it. */
.root:not([data-webdriver='1']) .floating-label-inner.is-glow {
  filter:
    drop-shadow(0 0 calc(6px + 14px * var(--glow)) rgba(255, 255, 255, 0.38))
    drop-shadow(0 0 calc(8px + 18px * var(--glow)) currentColor)
    drop-shadow(0 10px 22px rgba(0, 0, 0, 0.2));
  text-shadow:
    0 0 12px rgba(0, 0, 0, 0.92),
    0 0 12px currentColor,
    0 0 calc(4px + 12px * var(--glow)) rgba(255, 255, 255, 0.52);
}

@keyframes floatUpFade {
  0% {
    opacity: 0;
    transform: translate3d(-50%, -50%, 0) scale(var(--overlay-scale, 1)) translate3d(0, 0, 0);
  }
  8% {
    opacity: 1;
    transform: translate3d(-50%, -50%, 0) scale(var(--overlay-scale, 1)) translate3d(0, -2px, 0);
  }
  60% {
    opacity: 1;
    transform: translate3d(-50%, -50%, 0) scale(var(--overlay-scale, 1)) translate3d(0, -14px, 0);
  }
  100% {
    opacity: 0;
    transform: translate3d(-50%, -50%, 0) scale(var(--overlay-scale, 1)) translate3d(0, -34px, 0);
  }
}

/* ── Premium clearing amount label ── */

.floating-label-inner.clearing-premium {
  font-size: 32px;
  font-weight: 800;
  letter-spacing: 0.02em;
  color: #fbbf24 !important;
  animation: clearingPremiumPop 4.2s cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
  text-shadow:
    0 0 20px rgba(251, 191, 36, 0.9),
    0 0 40px rgba(251, 191, 36, 0.5),
    0 0 6px rgba(0, 0, 0, 0.95),
    0 2px 4px rgba(0, 0, 0, 0.6);
  filter:
    drop-shadow(0 0 12px rgba(251, 191, 36, 0.7))
    drop-shadow(0 0 28px rgba(249, 115, 22, 0.35));
  white-space: nowrap;
  will-change: transform, opacity;
}

/*
 * Compositor-only animation: a single translate3d handles centering + vertical drift,
 * scale is a separate property — no nested calc() chains, no layout thrashing.
 * Trajectory: pop from slightly below, settle, then gently drift upward and dissolve.
 */
@keyframes clearingPremiumPop {
  0% {
    opacity: 0;
    transform: translate3d(-50%, -50%, 0) scale(calc(var(--overlay-scale, 1) * 0.5));
  }
  6% {
    opacity: 1;
    transform: translate3d(-50%, -50%, 0) scale(calc(var(--overlay-scale, 1) * 1.12));
  }
  14% {
    opacity: 1;
    transform: translate3d(-50%, -50%, 0) scale(var(--overlay-scale, 1));
  }
  50% {
    opacity: 1;
    transform: translate3d(-50%, calc(-50% - 6px), 0) scale(calc(var(--overlay-scale, 1) * 1.03));
  }
  75% {
    opacity: 0.8;
    transform: translate3d(-50%, calc(-50% - 16px), 0) scale(calc(var(--overlay-scale, 1) * 1.06));
  }
  100% {
    opacity: 0;
    transform: translate3d(-50%, calc(-50% - 30px), 0) scale(calc(var(--overlay-scale, 1) * 1.12));
  }
}
