# GEO Simulator Frontend — Правила рендера графа (узлы/рёбра/LOD)

Статус: Draft
Область: simulator
Последнее обновление: 2026-01-23

Цель: зафиксировать «правила построения картинки», чтобы изменения в рендере/данных не ломали семантику и не приводили к неожиданным цветам/толщинам.

## 0) Семантика направлений (важно)

- TrustLine direction: `from → to` = **creditor → debtor** (risk limit), НЕ наоборот.

Если в визуале показываем стрелки/движение — это направление должно совпадать с этим правилом.

## 1) Источник данных и ответственность

- Snapshot + `viz_*` ключи — источник истины.
- UI:
  - валидирует структуру,
  - применяет `viz_*` как есть,
  - деградирует по LOD/качеству (без изменения семантики).

Контракт: [api.md](api.md).

## 2) Узлы

### 2.1 Форма

- `person` — круг
- `business` — квадрат/скруглённый прямоугольник

### 2.2 Цвет

- Цвет — через `viz_color_key` и таблицу маппинга.
- Статусы (`suspended/left/deleted`) должны быть визуально отличимы от debt-градиента.

### 2.3 Размер

- Размер узла приходит как `viz_size` (w/h).
- UI не нормализует и не вычисляет abs(net) и т.п.

## 3) Рёбра

### 3.1 Базовая читаемость

- Толщина: `viz_width_key` → `width_px`.
- Прозрачность: `viz_alpha_key` → `alpha`.
- Цвет по умолчанию — нейтральный (slate).

Таблица ключей: [specs/GEO-visual-demo-fast-mock.md](specs/GEO-visual-demo-fast-mock.md).

### 3.2 LOD

На малых масштабах/больших графах:
- снижать визуальный шум через alpha/width,
- отключать подписи,
- не добавлять постоянные «мерцающие» эффекты.

## 4) Разделение: базовый граф vs FX overlay

- Базовый граф отвечает за структуру (узлы/рёбра + простая подсветка выбора/фокуса).
- FX overlay отвечает за событийность (tx/clearing).

Практическое правило:
- всё, что выглядит как «движение вдоль ребра» — должно жить в FX (Spark/EdgePulse), а не в перекраске базового ребра.

## 5) Где реализовано

- Базовый рендер: `simulator-ui/v2/src/render/baseGraph.ts`
- Рендер узлов: `simulator-ui/v2/src/render/nodePainter.ts`
- FX overlay: `simulator-ui/v2/src/render/fxRenderer.ts`
- Маппинг ключей: `simulator-ui/v2/src/vizMapping.ts`
