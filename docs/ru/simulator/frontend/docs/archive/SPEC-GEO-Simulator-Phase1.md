# Техническое Задание: GEO Simulator — Этап 1 (Интерактивная визуализация)

**Версия:** 1.0
**Дата:** 2026-01-18
**Статус:** Draft

---

## 1. Обзор и Цели

### 1.1. Контекст
Симулятор GEO — это инструмент для визуализации и моделирования работы децентрализованной кредитной сети. В отличие от административного интерфейса (Admin UI), симулятор должен предоставлять "игровой", иммерсивный опыт, наглядно демонстрирующий концепции доверия, транзакций и клиринга.

### 1.2. Цель Этапа 1
Разработать MVP (Minimum Viable Product) интерактивного графа на стеке Vue 3, реализующего "космическую" визуальную метафору.

**Ключевые метрики успеха:**
*   Стабильные 60 FPS при 100+ узлах.
*   Реализация визуального стиля "Deep Space" (Bloom, Particles).
*   Интерактивность (выделение, HUD).
*   Демонстрация базовой физики (транзакции, клиринг).

---

## 2. Технологический Стек

| Компонент | Технология | Обоснование |
|-----------|------------|-------------|
| **Framework** | **Vue 3 (Composition API)** | Стандарт проекта, реактивность, удобство работы с состоянием. |
| **State Management** | **Pinia** | Управление глобальным состоянием (выбранный узел, настройки симуляции). |
| **Rendering** | **Native Canvas API (2D)** | Максимальная производительность и контроль над рендерингом (Bloom, Particles) без оверхеда тяжелых библиотек. |
| **Physics Engine** | **d3-force** | Только математика (расчет координат). Рендеринг полностью кастомный. |
| **Styling** | **Tailwind CSS** | Стилизация UI-оверлеев (HUD, кнопки). |
| **Icons** | **Lucide Vue** | Иконки для UI. |

---

## 3. Архитектура Компонентов

### 3.1. Структура файлов
```
src/
  components/
    simulator/
      GeoSimulatorMesh.vue    # Основной контейнер (Canvas + UI Overlay)
      GeoNodeCard.vue         # HUD-карточка выбранного узла (HTML)
      SimulatorControls.vue   # Панель управления (кнопки Tx, Clearing)
  composables/
    simulator/
      useGeoPhysics.ts        # Логика d3-force, управление частицами
      useGeoRenderer.ts       # Функции отрисовки Canvas (Draw Calls)
      useGeoData.ts           # Генерация мок-данных и управление состоянием графа
```

### 3.2. Описание компонентов

#### `GeoSimulatorMesh.vue`
*   **Роль:** Оркестратор. Инициализирует Canvas, запускает `requestAnimationFrame` loop.
*   **Props:** Нет (данные через Pinia или composable).
*   **Events:** Клик по Canvas (делегируется в физический движок для определения hit-test).

#### `useGeoPhysics.ts`
*   **State:** `nodes`, `links`, `particles`, `explosions`.
*   **Methods:**
    *   `initSimulation(data)`: Настройка d3-force.
    *   `update(dt)`: Шаг физики (движение узлов, частиц).
    *   `triggerTransaction(sourceId, targetId)`: Спавн частицы транзакции.
    *   `triggerClearing()`: Запуск алгоритма поиска циклов и спавн "встречных" частиц.

#### `useGeoRenderer.ts`
*   **Methods:**
    *   `render(ctx, state, width, height)`: Главная функция отрисовки кадра.
    *   `drawNodes(...)`: Отрисовка узлов с учетом типа (Business/Person) и Bloom-эффекта.
    *   `drawConnections(...)`: Отрисовка связей (активные/пассивные).
    *   `drawParticles(...)`: Отрисовка частиц и взрывов.

---

## 4. Визуальная Спецификация (Design Tokens)

### 4.1. Палитра
*   **Background:** `#020408` (Deep Space).
*   **Business Node:** `#10b981` (Emerald-500) — Квадрат.
*   **Person Node:** `#3b82f6` (Blue-500) — Круг.
*   **Trustline (Idle):** `rgba(148, 163, 184, 0.1)` (Slate-400, low opacity).
*   **Trustline (Active):** Gradient `Blue -> White -> Emerald` + Glow.
*   **Transaction Particle:** `#ffffff` (White core) + `#22d3ee` (Cyan trail).
*   **Clearing Spark:** `#fbbf24` (Amber-400).

### 4.2. Слои отрисовки (Z-Index)
1.  **Background:** Заливка + Параллакс звезд (2-3 слоя).
2.  **Connections (Passive):** Тусклые линии.
3.  **Connections (Active):** Яркие линии (Composite: `lighter`).
4.  **Nodes (Glow):** Радиальные градиенты (Bloom).
5.  **Nodes (Body):** Геометрия узлов.
6.  **Particles:** Частицы транзакций и взрывы (Composite: `lighter`).
7.  **UI Overlay:** Линии-поводки к карточкам.
8.  **HUD:** HTML-элементы поверх Canvas.

---

## 5. Функциональные Требования

### 5.1. Генерация Графа
*   **Алгоритм:** Спиральное распределение (Golden Angle) для предотвращения наложений при старте.
*   **Количество:** 35-50 узлов.
*   **Типы:** 20% Business, 80% Person.
*   **Связи:** Каждый узел соединяется с 2-4 ближайшими соседями.

### 5.2. Интерактивность
*   **Hover:** Нет (для оптимизации).
*   **Click:**
    *   Выбор узла (`selectedNode`).
    *   Камера не смещается (в MVP), но подсвечиваются связи выбранного узла.
    *   Появление HUD-карточки рядом с узлом.
*   **Click (Background):** Сброс выделения или запуск случайной транзакции (Easter egg).

### 5.3. Анимации
*   **Idle:** Узлы слегка "дышат" (плавают) по синусоиде.
*   **Transaction:** Частица летит от A к B по прямой. След (trail) затухает.
*   **Clearing:**
    *   Поиск треугольника A->B->C.
    *   Запуск частиц навстречу друг другу.
    *   При столкновении в центре связи — взрыв (система частиц).
    *   Уменьшение баланса (визуально в HUD).

---

## 6. План Разработки

### Шаг 1: Каркас и Рендеринг (Day 1)
1.  Создать структуру директорий и пустые компоненты.
2.  Реализовать `useGeoData` для генерации мок-данных.
3.  Настроить `GeoSimulatorMesh` и базовый цикл `requestAnimationFrame`.
4.  Реализовать отрисовку фона и статичных узлов/связей в `useGeoRenderer`.

### Шаг 2: Физика и Интерактивность (Day 1-2)
1.  Подключить `d3-force` в `useGeoPhysics`.
2.  Реализовать Drag & Drop узлов (опционально) или просто физическую стабилизацию.
3.  Добавить обработку клика (Hit-test) и состояние `selectedNode`.
4.  Реализовать подсветку активных связей и затемнение остальных.

### Шаг 3: UI и Эффекты (Day 2)
1.  Сверстать `GeoNodeCard.vue` (Glassmorphism).
2.  Реализовать синхронизацию позиции карточки с координатами узла.
3.  Добавить Bloom-эффекты (радиальные градиенты) под узлами.

### Шаг 4: Частицы и Геймификация (Day 3)
1.  Реализовать систему частиц (класс `Particle`).
2.  Добавить логику "Single Transaction" (запуск частицы).
3.  Добавить логику "Clearing" (взрывы и обновление баланса).
4.  Финальная полировка (цвета, тайминги, шрифты).
