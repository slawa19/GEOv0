# GEO Simulator Frontend — Визуальный язык (палитра, ключи, приоритеты)

Статус: Draft
Область: simulator
Последнее обновление: 2026-01-27

Цель: собрать в одном месте правила, которые постоянно нужны при разработке визуализации графа и FX.

## 0) Базовый принцип (SoT)

- UI **не вычисляет семантику** цветов/размеров/толщин/альф.
- UI **интерпретирует готовые ключи** `viz_*` из snapshot/events.

Источник правды по контракту: [api.md](api.md).

**Важно:** Код `vizMapping.ts` является источником правды для конкретных значений. Документация может отставать — при расхождениях смотреть код.

## 1) Ключи `viz_*` и строгий режим

- `viz_color_key` / `viz_width_key` / `viz_alpha_key` должны быть известными ключами.
- В demo-fast-mock v2 неизвестный ключ считается ошибкой (fail-fast), чтобы не «утверждать визуал» на непредсказуемых фолбэках.

Кодовая реализация текущего маппинга (SoT): `simulator-ui/v2/src/vizMapping.ts`

### 1.1 Актуальные значения (sync: 2026-01-27)

**link.width_px:**
| Ключ | Значение (px) |
|------|---------------|
| hairline | 0.6 |
| thin | 0.9 |
| mid | 1.1 |
| thick | 1.25 |
| highlight | 2.2 |

**link.alpha:**
| Ключ | Значение |
|------|----------|
| bg | 0.06 |
| muted | 0.12 |
| active | 0.20 |
| hi | 0.32 |

Примечание: значения оптимизированы для тёмного фона (#020617) и небольших графов (~100 узлов).

## 2) Палитра и семантика (коротко)

### 2.1 Узлы

- `business`: зелёный (emerald), форма “квадрат/скруглённый прямоугольник”.
- `person`: синий, форма “круг”.
- `suspended/left/deleted`: серо-сланцевые оттенки (не путать с debt-градиентом).
- `debt-0..debt-8`: градиент должника от светло-жёлтого к красному.

### 2.2 Рёбра

- Базовый цвет рёбер — нейтральный (slate), а читаемость регулируется `viz_width_key` + `viz_alpha_key`.
- Смысловые подсветки (tx/clearing) делаются через FX overlay, а не через постоянные изменения базового графа.

### 2.3 FX

Текущая конвенция цветов FX:
- Single Tx: cyan (#22d3ee)
- Clearing: gold (#fbbf24)

См. подробности и правила композиции: [fx-playbook.md](fx-playbook.md).

## 3) Приоритеты (чтобы не было визуальных конфликтов)

### 3.1 Узлы

1) Статусные цвета (`suspended/left/deleted`) перекрывают всё.
2) Для active-узлов цвет/размер приходят от backend/fixtures через `viz_*`.

### 3.2 Рёбра и эффекты

1) «Базовый граф» отвечает за постоянную читаемость структуры (LOD, альфа, толщина).
2) «FX overlay» отвечает за событийность (tx, clearing, impact/glow).

Практическое правило: если нужен “пролёт”/движение вдоль ребра — это FX (spark/pulse), а не перекраска базового ребра.

## 4) Типографика (HUD/карточки)

Для любого текста (панель/карточки/подсказки) используем принципы админки:
- [docs/ru/admin-ui/typography.md](../../../../admin-ui/typography.md)

## 5) Где править, если меняется визуальный язык

- Маппинг ключей/палитра: `simulator-ui/v2/src/vizMapping.ts`
- Рендер базового графа: `simulator-ui/v2/src/render/baseGraph.ts`
- Рендер FX overlay: `simulator-ui/v2/src/render/fxRenderer.ts`
