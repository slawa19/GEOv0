# –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–∫–Ω–∞–º–∏ Interact Mode
> –î–∞—Ç–∞: 2026-02-21 | –†–µ–≤–∏–∑–∏—è: R3 2026-02-21 | –°—Ç–∞—Ç—É—Å: IN PROGRESS | –°—Ç–∞—Ç—É—Å —Ä–µ–≤—å—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: DONE ‚Äî –≤—Å–µ –ø—É–Ω–∫—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã, ¬ß7 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω | –ê–≤—Ç–æ—Ä: code-review

---

## 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç

Interact Mode ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º simulator-ui/v2 (Vue 3 + Composition API), –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–ª–∞—Ç–µ–∂–∞–º–∏, trustline-–∞–º–∏ –∏ –∫–ª–∏—Ä–∏–Ω–≥–æ–º —á–µ—Ä–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º ‚Äî FSM (`useInteractMode.ts`) —Å 11 —Ñ–∞–∑–∞–º–∏:

```
idle ‚Üí picking-payment-from ‚Üí picking-payment-to ‚Üí confirm-payment
     ‚Üí picking-trustline-from ‚Üí picking-trustline-to ‚Üí confirm-trustline-create
     ‚Üí editing-trustline
     ‚Üí confirm-clearing ‚Üí clearing-preview ‚Üí clearing-running
```

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: TopBar, ActionBar, ManualPaymentPanel, TrustlineManagementPanel, ClearingPanel, EdgeDetailPopup, NodeCardOverlay, EdgeTooltip, ErrorToast, InteractHistoryLog, SystemBalanceBar.

---

## 2. –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 2.1 [HIGH] –ú—ë—Ä—Ç–≤—ã–π `v-if` –≤ EdgeDetailPopup ‚Äî popup__grid –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è

**–§–∞–π–ª:** `simulator-ui/v2/src/components/EdgeDetailPopup.vue:125`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–µ–±—Ä–∞ (Used / Limit / Available / Status) –∏–º–µ–µ—Ç —É—Å–ª–æ–≤–∏–µ `v-if="phase !== 'editing-trustline'"`. –ù–æ —Å–∞–º –ø–æ–ø–∞–ø –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ `open = phase === 'editing-trustline' && !!anchor`. –£—Å–ª–æ–≤–∏—è –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞–µ–º—ã ‚Äî –±–ª–æ–∫ **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```html
<div v-if="open" class="ds-panel popup" :style="popupStyle">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∏... -->
  
  <!-- –ú–Å–†–¢–í–´–ô –ö–û–î: phase !== 'editing-trustline' –Ω–∏–∫–æ–≥–¥–∞ true –≤–Ω—É—Ç—Ä–∏ open -->
  <div v-if="phase !== 'editing-trustline'" class="popup__grid">
    <div class="ds-label">Used</div>
    <div class="ds-value ds-mono">{{ used ?? '‚Äî' }} {{ unit }}</div>
    <div class="ds-label">Limit</div>
    <div class="ds-value ds-mono">{{ limit ?? '‚Äî' }} {{ unit }}</div>
    <!-- ... -->
  </div>
</div>
```

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å `v-if="phase !== 'editing-trustline'"` —Å —ç–ª–µ–º–µ–Ω—Ç–∞ `popup__grid`. –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π `v-if="open"` —É–∂–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω—É–∂–Ω—É—é —Ñ–∞–∑—É.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ä–µ–±—Ä–æ —É–≤–∏–¥–∏—Ç –≤ –ø–æ–ø–∞–ø–µ Used/Limit/Available/Status –¥–∞–Ω–Ω—ã–µ.

---

### 2.2 [MEDIUM] edgeDetailAnchor –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏–∑ NodeCard

**–§–∞–π–ª:** `simulator-ui/v2/src/components/SimulatorAppRoot.vue:411-413`

**–û–ø–∏—Å–∞–Ω–∏–µ:** `edgeDetailAnchor` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ä–µ–±—Ä–æ –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ `editing-trustline` –¥—Ä—É–≥–∏–º –ø—É—Ç—ë–º (—á–µ—Ä–µ–∑ NodeCard). –°—Ü–µ–Ω–∞—Ä–∏–π:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–Ω—É–ª —Ä–µ–±—Ä–æ ‚Üí anchor = {400, 200}
2. –ó–∞–∫—Ä—ã–ª —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
3. –û—Ç–∫—Ä—ã–ª —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ NodeCard ‚Üí anchor –æ—Å—Ç–∞—ë—Ç—Å—è {400, 200}
4. EdgeDetailPopup –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å—Ç–∞—Ä–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–∏–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ –ø–æ –º–µ—Å—Ç—É)

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```typescript
// SimulatorAppRoot.vue
function onInteractEditTrustline(fromPid: string, toPid: string) {
  setNodeCardOpen(false)
  edgeDetailAnchor.value = null  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
  interact.mode.selectTrustline(fromPid, toPid)
}

function onInteractNewTrustline(fromPid: string) {
  setNodeCardOpen(false)
  edgeDetailAnchor.value = null  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
  interact.mode.startTrustlineFlow()
  interact.mode.setTrustlineFromPid(fromPid)
}
```

---

### 2.3 [MEDIUM] newLimit –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ trustline –≤–Ω—É—Ç—Ä–∏ editing-—Ñ–∞–∑—ã

**–§–∞–π–ª:** `simulator-ui/v2/src/components/TrustlineManagementPanel.vue:39-53`

**–û–ø–∏—Å–∞–Ω–∏–µ:** Watch –Ω–∞ `props.phase` –∑–∞–ø–æ–ª–Ω—è–µ—Ç `newLimit` —Ç–æ–ª—å–∫–æ –ø—Ä–∏ *–ø–µ—Ä–µ—Ö–æ–¥–µ* –≤ `editing-trustline`. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç trustline —á–µ—Ä–µ–∑ dropdown ¬´Existing¬ª (selectTrustline), —Ñ–∞–∑–∞ –æ—Å—Ç–∞—ë—Ç—Å—è `editing-trustline`, watch –Ω–µ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—Å—è, –ø–æ–ª–µ ¬´New limit¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ trustline.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π watcher:

```typescript
watch(
  () => `${String(props.state.fromPid ?? '')}‚Üí${String(props.state.toPid ?? '')}`,
  () => {
    if (props.phase === 'editing-trustline') {
      const cur = props.currentLimit
      newLimit.value = (cur != null && String(cur).trim()) ? String(cur) : ''
    }
  },
)
```

---

### 2.4 [MEDIUM] Double-click –≤ picking-—Ñ–∞–∑–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç NodeCardOverlay –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –ø–∞–Ω–µ–ª—å—é

**–§–∞–π–ª—ã:** `simulator-ui/v2/src/composables/useSimulatorApp.ts:1323`, `simulator-ui/v2/src/composables/useCanvasInteractions.ts:92-96`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ double-click –Ω–∞ —É–∑–µ–ª `onCanvasDblClick` –±–µ–∑—É—Å–ª–æ–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `setNodeCardOpen(true)`. –í picking-—Ñ–∞–∑–∞—Ö single-click –ø—Ä–æ–¥–≤–∏–≥–∞–µ—Ç FSM (–≤—ã–±–æ—Ä from/to). –†–µ–∑—É–ª—å—Ç–∞—Ç: ManualPaymentPanel (–∏–ª–∏ TrustlinePanel) –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π –ò –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è NodeCardOverlay ‚Äî –¥–≤–∞ –¥–∏–∞–ª–æ–≥–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í wiring double-click –¥–æ–±–∞–≤–∏—Ç—å guard:

```typescript
// –í useSimulatorApp.ts –∏–ª–∏ useAppCanvasInteractionsWiring
onCanvasDblClick: (ev: MouseEvent) => {
  wakeUp()
  if (isInteractPickingPhase.value) {
    // –í picking-—Ñ–∞–∑–∞—Ö double-click = –æ–±—ã—á–Ω—ã–π single-click (–≤—ã–±–æ—Ä —É–∑–ª–∞)
    canvasInteractions.onCanvasClick(ev)
    return
  }
  canvasInteractions.onCanvasDblClick(ev)
}
```

–ì–¥–µ `isInteractPickingPhase` ‚Äî computed:

```typescript
const isInteractPickingPhase = computed(() => {
  const p = interact?.mode?.state?.phase
  return p?.startsWith('picking-') ?? false
})
```

---

### 2.5 [MEDIUM] EdgeDetailPopup clamping –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —à–∏—Ä–∏–Ω—É –ø–æ–ø–∞–ø–∞

**–§–∞–π–ª:** `simulator-ui/v2/src/components/EdgeDetailPopup.vue:50-52`

**–û–ø–∏—Å–∞–Ω–∏–µ:** Clamping –ø–æ X: `clamp(anchor.x + 12, 10, w - 10)`. –ü—Ä–∏ –∫–ª–∏–∫–µ —É –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∞—è viewport –ø–æ–ø–∞–ø (min-width: 260px) –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ 10px –æ—Ç –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∞—è –∏ —É–µ–∑–∂–∞–µ—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—É –Ω–∞ 250px.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```typescript
const MIN_POPUP_W = 260  // = min-width –≤ CSS
const MIN_POPUP_H = 140  // –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞
const pad = 10
const x = clamp(props.anchor.x + 12, pad, w - MIN_POPUP_W - pad)
const y = clamp(props.anchor.y + 12, pad, h - MIN_POPUP_H - pad)
```

---

### 2.6 [LOW] updateValid –∏—Å–ø–æ–ª—å–∑—É–µ—Ç props.used –≤–º–µ—Å—Ç–æ effectiveUsed

**–§–∞–π–ª:** `simulator-ui/v2/src/components/TrustlineManagementPanel.vue:55-77`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í–∞–ª–∏–¥–∞—Ç–æ—Ä `newLimit >= usedNum` –±–µ—Ä—ë—Ç `props.used` (–∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞ –≥—Ä–∞—Ñ–∞), –∞ UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `effectiveUsed` (–∏–∑ fetched trustlines ‚Äî –±–æ–ª–µ–µ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ). –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ Used, –∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ –¥—Ä—É–≥–æ–º—É.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```typescript
const usedNum = computed(() => {
  const v = Number(effectiveUsed.value ?? 0)
  return Number.isFinite(v) ? v : 0
})
```

---

### 2.7 [LOW] ActionBar –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Ñ–∞–∑–µ

**–§–∞–π–ª:** `simulator-ui/v2/src/components/ActionBar.vue:22-31`

**–û–ø–∏—Å–∞–Ω–∏–µ:** `isDisabled = busy || actionsDisabled || runTerminal`. –ö–Ω–æ–ø–∫–∏ –∞–∫—Ç–∏–≤–Ω—ã –≤ –ª—é–±–æ–π –Ω–µ-busy —Ñ–∞–∑–µ. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω–∏–ª —Ñ–æ—Ä–º—É –ø–ª–∞—Ç–µ–∂–∞ –∏ –Ω–∞–∂–∞–ª ¬´Run Clearing¬ª ‚Äî –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–≤–∞—Ä–∏–∞–Ω—Ç –ê ‚Äî –º—è–≥–∫–∏–π):** –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ flow:

```html
<button :class="{ 'ds-btn--muted': phase !== 'idle' && !phaseMatchesAction }"
        :title="phase !== 'idle' ? 'Cancel current action first' : ''">
```

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–≤–∞—Ä–∏–∞–Ω—Ç –ë ‚Äî —Å—Ç—Ä–æ–≥–∏–π):** –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ:

```typescript
const isDisabled = computed(() => 
  busy.value || actionsDisabled.value || runTerminal.value || 
  (phase.value !== 'idle')  // –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å, –ø–æ–∫–∞ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π flow
)
```

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –í–∞—Ä–∏–∞–Ω—Ç –ê ‚Äî –º—è–≥–∫–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è (—Ç–µ–∫—É—â–∏–π UX-–ø—Ä–∏–Ω—Ü–∏–ø: cancel –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–≥–¥–∞).

---

### 2.8 [LOW] popup__actions –±–µ–∑ flex-wrap –∏ gap

**–§–∞–π–ª:** `simulator-ui/v2/src/components/EdgeDetailPopup.vue:192-196`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ `closeArmed=true` –ø–æ—è–≤–ª—è—é—Ç—Å—è 4 –∫–Ω–æ–ø–∫–∏ (~350px). –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (min-width: 260px) –∫–Ω–æ–ø–∫–∏ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```css
.popup__actions {
  display: flex;
  flex-wrap: wrap;    /* –¥–æ–±–∞–≤–∏—Ç—å */
  gap: 6px;           /* –¥–æ–±–∞–≤–∏—Ç—å */
  justify-content: flex-end;
  margin-top: 10px;
}
```

---

### 2.9 [HIGH] EdgeDetailPopup: edgeDetailAnchor –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ cancel/ESC

**–§–∞–π–ª:** `simulator-ui/v2/src/composables/useSimulatorApp.ts:861`, `useInteractMode.ts:cancel()`

**–û–ø–∏—Å–∞–Ω–∏–µ:** `edgeDetailAnchor` (ref –≤ `useSimulatorApp.ts:861`) –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ `null` –Ω–∏ –ø—Ä–∏ `cancel()`, –Ω–∏ –ø—Ä–∏ `resetToIdle()` –≤ FSM. –≠—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±–∞–≥–∞ ¬ß2.2 ‚Äî —Å—Ç–µ–π–ª anchor –º–æ–∂–µ—Ç ¬´–≤—Å–ø–ª—ã—Ç—å¬ª –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏–∑ NodeCard, –Ω–æ –∏ –≤ –ª—é–±–æ–º –ø–æ—Å–ª–µ–¥—É—é—â–µ–º `editing-trustline`, –æ—Ç–∫—Ä—ã—Ç–æ–º –Ω–µ —á–µ—Ä–µ–∑ –∫–ª–∏–∫ –Ω–∞ —Ä–µ–±—Ä–æ.

**–°—Ü–µ–Ω–∞—Ä–∏–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:**
1. –ö–ª–∏–∫ –Ω–∞ —Ä–µ–±—Ä–æ ‚Üí anchor = {400, 200}, EdgeDetailPopup —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è
2. ESC ‚Üí `cancel()` ‚Üí phase = idle, **–Ω–æ** `edgeDetailAnchor` = {400, 200}
3. –ß–µ—Ä–µ–∑ NodeCard: ¬´Edit trustline¬ª ‚Üí `onInteractEditTrustline` ‚Üí phase = editing-trustline
4. `open = phase === 'editing-trustline' && !!anchor` ‚Üí **true** (—Å—Ç–µ–π–ª anchor!)
5. –ü–æ–ø–∞–ø —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤ –ø–æ–∑–∏—Ü–∏–∏ —Å—Ç–∞—Ä–æ–≥–æ —Ä–µ–±—Ä–∞, –∞ –Ω–µ —Ä—è–¥–æ–º —Å —Ç–µ–∫—É—â–∏–º

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü–æ–º–∏–º–æ ¬ß2.2, –¥–æ–±–∞–≤–∏—Ç—å —Å–±—Ä–æ—Å –ø—Ä–∏ cancel ‚Äî –∏–ª–∏ (–ª—É—á—à–µ) —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ¬ß3.1 (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è anchor –≤ FSM).

**Workaround (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π):** –í `SimulatorAppRoot.vue` –¥–æ–±–∞–≤–∏—Ç—å watch:
```typescript
watch(interactPhase, (p) => {
  if (p === 'idle') edgeDetailAnchor.value = null
})
```

---

### 2.10 [MEDIUM] ErrorToast –∏ InteractHistoryLog –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è

**–§–∞–π–ª—ã:** `ErrorToast.vue` (CSS: `bottom: 68px; left: 50%; z-index: 200`), `SimulatorAppRoot.vue` (inline: `right: 12px; bottom: 68px`)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –Ω–∞–ª–∏—á–∏–∏ –æ—à–∏–±–∫–∏ –∏ –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ ‚Äî –æ–±–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è –≤ –æ–¥–Ω–æ–π –ø–æ–ª–æ—Å–µ `bottom: 68px`. ErrorToast —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω (`left: 50%`, max-width 480px), history —Å–ø—Ä–∞–≤–∞. –ù–∞ viewport < ~1000px —Ç–æ—Å—Ç –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç history, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç ‚Äî history (pointer-events: none) –Ω–µ –º–µ—à–∞–µ—Ç –∫–ª–∏–∫—É, –Ω–æ —Ç–æ—Å—Ç –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –°–¥–≤–∏–Ω—É—Ç—å InteractHistoryLog –≤—ã—à–µ:
```html
<!-- SimulatorAppRoot.vue -->
<div
  v-if="isInteractUi && interact.mode.history.length > 0"
  class="ds-ov-bottom"
  style="right: 12px; left: auto; bottom: 120px; ..."
>
```
–ò–ª–∏ –ø—Ä–∏–≤—è–∑–∞—Ç—å ErrorToast –∫ `bottom: 120px` –∏ –¥–∞—Ç—å history `bottom: 68px` (–±–ª–∏–∂–µ –∫ BottomBar).

---

### 2.11 [MEDIUM] ManualPaymentPanel –∏ TrustlineManagementPanel: –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ top-right

**–§–∞–π–ª—ã:** `designSystem.overlays.css` (`.ds-ov-panel { right: 12px; top: 110px }`), `SimulatorAppRoot.vue`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±–∞ –ø–∞–Ω–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π CSS-–∫–ª–∞—Å—Å `.ds-ov-panel` (position: absolute; right: 12px; top: 110px). FSM –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–±–µ –ø–∞–Ω–µ–ª–∏ –ù–ï –æ—Ç–∫—Ä—ã—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Äî –Ω–æ –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–π —Å–º–µ–Ω–µ —Ñ–∞–∑ (ActionBar click) –∞–Ω–∏–º–∞—Ü–∏—è `<Transition name="panel-slide">` —Å–æ–∑–¥–∞—ë—Ç –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –≤—ã—Ö–æ–¥—è—â–∞—è –ø–∞–Ω–µ–ª—å –µ—â—ë –Ω–µ —É—à–ª–∞, –∞ –≤—Ö–æ–¥—è—â–∞—è —É–∂–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è. –û–±–µ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ ~0.2—Å.

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –°–µ–π—á–∞—Å —ç—Ç–æ –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞, —Ç.–∫. –æ–±—ã—á–Ω—ã–π user flow: cancel ‚Üí idle ‚Üí startNewFlow. –ù–æ –ø—Ä—è–º–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ (–∏–∑ confirm-payment ‚Üí startTrustlineFlow) —á–µ—Ä–µ–∑ ActionBar (¬ß2.7 –ø–æ–∑–≤–æ–ª—è–µ—Ç) —Å–æ–∑–¥–∞—ë—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–≤–∞—Ä–∏–∞–Ω—Ç –ê ‚Äî quick):** –î–æ–±–∞–≤–∏—Ç—å `mode="out-in"` –≤ Transition:
```html
<Transition name="panel-slide" mode="out-in">
```
–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫: Vue `mode="out-in"` —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –æ–±–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–º–µ–ª–∏ –µ–¥–∏–Ω—ã–π parent Transition, —á—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–ª—è –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–≤–∞—Ä–∏–∞–Ω—Ç –ë ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):** –û–±–µ—Ä–Ω—É—Ç—å –≤—Å–µ —Ç—Ä–∏ –ø–∞–Ω–µ–ª–∏ –≤ –µ–¥–∏–Ω—ã–π ¬´—Å–ª–æ—Ç¬ª —Å computed-–∫–ª—é—á–æ–º:
```html
<component :is="activePanelComponent" :key="activePanelKey" ... />
```
–ì–¥–µ `activePanelComponent` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω –∏–∑ —Ç—Ä—ë—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø–æ —Ñ–∞–∑–µ.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–≤–∞—Ä–∏–∞–Ω—Ç –í ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π):** –î–æ–±–∞–≤–∏—Ç—å `position: relative` –∏ `z-index` –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—é: –Ω–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –≤—ã—à–µ —Å—Ç–∞—Ä–æ–π.

---

### 2.12 [MEDIUM] ClearingPanel: –∫–Ω–æ–ø–∫–∞ ¬´Close¬ª –¥–æ—Å—Ç—É–ø–Ω–∞ –≤–æ –≤—Ä–µ–º—è clearing-preview/running

**–§–∞–π–ª:** `simulator-ui/v2/src/components/ClearingPanel.vue:85-87`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í —Ñ–∞–∑–∞—Ö `clearing-preview` –∏ `clearing-running` –∫–Ω–æ–ø–∫–∞ Close (`cancel`) –æ—Ç–∫–ª—é—á–µ–Ω–∞ —á–µ—Ä–µ–∑ `busyUi = busy || isRunning`. –û–¥–Ω–∞–∫–æ –≤ `clearing-preview` `isRunning = false` –∏ `busy = true` (runBusy –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ), –ø–æ—ç—Ç–æ–º—É –∫–Ω–æ–ø–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞. –ù–û: –µ—Å–ª–∏ clearing endpoint –æ—Ç–≤–µ—Ç–∏–ª –±—ã—Å—Ç—Ä–æ –∏ busy —Å–Ω—è–ª—Å—è –¥–æ `CLEARING_PREVIEW_DWELL_MS` (800ms) ‚Äî –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–µ—Ç –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞, —Ö–æ—Ç—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â—ë –Ω–µ —É—Å–ø–µ–ª –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

**–¢–æ—á–Ω–µ–µ:** –í `useInteractMode.ts:confirmClearing`, –ø–æ—Å–ª–µ `await opts.actions.runClearing()` busy –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è (`runBusy` wrapper), –Ω–æ `setTimeout(r, CLEARING_PREVIEW_DWELL_MS)` ‚Äî —ç—Ç–æ await –≤–Ω—É—Ç—Ä–∏ runBusy. –ó–Ω–∞—á–∏—Ç busy = true –ø–æ–∫–∞ dwell –Ω–µ –ø—Ä–æ–π–¥—ë—Ç. **–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è** ‚Äî –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ—á–Ω—ã–π. 

**–°—Ç–∞—Ç—É—Å:** ~~MEDIUM~~ ‚Üí **–ù–ï –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û** (busy –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è). –ü–æ–º–µ—Ç–∫–∞ –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏.

---

### 2.13 [LOW] TrustlineManagementPanel: dropdown ¬´Existing¬ª –≤ picking-from –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ TL –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ from

**–§–∞–π–ª:** `simulator-ui/v2/src/components/TrustlineManagementPanel.vue:173-180`

**–û–ø–∏—Å–∞–Ω–∏–µ:** `trustlinesForFrom` computed: –µ—Å–ª–∏ `state.fromPid` –µ—â—ë null (—Ñ–∞–∑–∞ `picking-trustline-from`), –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–≤—Å–µ** trustlines. Dropdown ¬´Existing¬ª –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∫–ª–∏–∫–Ω—É—Ç—å –ª—é–±–æ–π TL, —á—Ç–æ –ø–µ—Ä–µ–ø—Ä—ã–≥–Ω–µ—Ç –≤ `editing-trustline`, –º–∏–Ω—É—è picking-—à–∞–≥–∏. –≠—Ç–æ shortcut, –Ω–æ:
- –ù–µ–æ—á–µ–≤–∏–¥–Ω–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù–∞—Ä—É—à–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º—ã–π flow: ¬´—Å–Ω–∞—á–∞–ª–∞ –≤—ã–±—Ä–∞—Ç—å From, –ø–æ—Ç–æ–º To¬ª
- –í —Ñ–∞–∑–µ `isPickFrom` –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏ ¬´Trustline¬ª –Ω–µ –Ω–∞–º–µ–∫–∞–µ—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ shortcut

**–°–≤—è–∑–∞–Ω–æ —Å:** ¬ß3.5 (–æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å dropdown).

---

### 2.14 [LOW] NodeCardOverlay: interact actions –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç busy-—Å—Ç–∞—Ç—É—Å

**–§–∞–π–ª:** `simulator-ui/v2/src/components/NodeCardOverlay.vue:143-155`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ö–Ω–æ–ø–∫–∏ ¬´üí∏ Send Payment¬ª –∏ ¬´Ôºã New Trustline¬ª –≤ NodeCard –Ω–µ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è –ø—Ä–∏ `busy = true`. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–Ω–µ—Ç ¬´Send Payment¬ª –ø–æ–∫–∞ running trustline update ‚Äî `startPaymentFlow()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `if (busyRef.value) return`, –ø–æ—ç—Ç–æ–º—É –∫–ª–∏–∫ –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω. –ü—Ä–æ–±–ª–µ–º–∞ —á–∏—Å—Ç–æ UX: –∫–Ω–æ–ø–∫–∞ –≤—ã–≥–ª—è–¥–∏—Ç –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```html
<button
  class="ds-btn ds-btn--primary ds-btn--sm"
  type="button"
  :disabled="interactTrustlinesLoading"
  @click="onInteractSendPayment?.(node.id)"
>
```
–û–¥–Ω–∞–∫–æ `interactTrustlinesLoading` –Ω–µ —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `busy`. –õ—É—á—à–µ –¥–æ–±–∞–≤–∏—Ç—å prop `interactBusy`:
```typescript
:interact-busy="isInteractUi ? interact.mode.busy.value : undefined"
```

---

### 2.15 [CRITICAL] z-index –∫–æ–Ω—Ñ–ª–∏–∫—Ç: world labels / floating layers –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç –æ–∫–Ω–∞ –∏ –ø–∞–Ω–µ–ª–∏

**–§–∞–π–ª—ã:** [`simulator-ui/v2/src/App.css`](simulator-ui/v2/src/App.css:89), [`simulator-ui/v2/src/ui-kit/designSystem.overlays.css`](simulator-ui/v2/src/ui-kit/designSystem.overlays.css:217)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–ª–æ–∏ ¬´world labels / floating layers¬ª –∏–º–µ—é—Ç z-index –≤—ã—à–µ, —á–µ–º —É interact-–æ–∫–æ–Ω (–ø–∞–Ω–µ–ª–∏/–ø–æ–ø–∞–ø—ã). –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ü–µ–Ω–∞—Ö/–º–∞—Å—à—Ç–∞–±–∞—Ö/–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è—Ö label-—Å–ª–æ–∏ –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–≤–µ—Ä—Ö –æ–∫–æ–Ω: –æ–∫–Ω–æ –≤–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –Ω–æ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å —É—Ö—É–¥—à–∞—é—Ç—Å—è (–æ–∫–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –ª–µ–π–±–ª–∞–º–∏/—Å–ª–æ—è–º–∏).

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
1) –í–≤–µ—Å—Ç–∏ –µ–¥–∏–Ω—É—é —à–∫–∞–ª—É z-index (—Å–º. ¬ß3.9) –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ: **–æ–∫–Ω–∞/–ø–∞–Ω–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã—à–µ world-labels**, –∫—Ä–æ–º–µ –æ—Ç–¥–µ–ª—å–Ω–æ –æ–≥–æ–≤–æ—Ä—ë–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π.
2) –ü—Ä–∏–≤–µ—Å—Ç–∏ —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è z-index –≤ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Å—Ç–∏–ª—è—Ö –∫ —ç—Ç–æ–π —à–∫–∞–ª–µ (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ: –ø–æ–Ω–∏–∑–∏—Ç—å labels/floating layers –Ω–∏–∂–µ –æ–∫–æ–Ω, –ª–∏–±–æ –ø–æ–¥–Ω—è—Ç—å –æ–∫–Ω–∞ –≤—ã—à–µ labels ‚Äî –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∏–Ω—è—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞).

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –õ—é–±–æ–µ interact-–æ–∫–Ω–æ –≤—Å–µ–≥–¥–∞ –≤–∏–∑—É–∞–ª—å–Ω–æ –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ ¬´–ø–æ–≤–µ—Ä—Ö¬ª world labels.

---

### 2.16 [HIGH] EdgeTooltip clamp –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —à–∏—Ä–∏–Ω—É —Ç—É–ª—Ç–∏–ø–∞

**–§–∞–π–ª:** [`simulator-ui/v2/src/composables/useEdgeTooltip.ts`](simulator-ui/v2/src/composables/useEdgeTooltip.ts:41)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ EdgeTooltip –∏—Å–ø–æ–ª—å–∑—É–µ—Ç clamping –ø–æ viewport, –Ω–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ—á–∫—É —è–∫–æ—Ä—è/–ø–∞–¥–¥–∏–Ω–≥–∏. –®–∏—Ä–∏–Ω–∞ —Ç—É–ª—Ç–∏–ø–∞ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏, –∏–∑-–∑–∞ —á–µ–≥–æ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Ä–µ–±—Ä–æ —É –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∞—è —Ç—É–ª—Ç–∏–ø —É–µ–∑–∂–∞–µ—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –°—á–∏—Ç–∞—Ç—å clamping –ø–æ X/Y —Å —É—á—ë—Ç–æ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —Ç—É–ª—Ç–∏–ø–∞ (–∏–ª–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö min/max —Ä–∞–∑–º–µ—Ä–æ–≤). –í–∞—Ä–∏–∞–Ω—Ç—ã:
- –∏–∑–º–µ—Ä—è—Ç—å `tooltipEl.getBoundingClientRect()` –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞ –∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å `w - tooltipWidth - pad`;
- –∏–∑–º–µ–Ω–∏—Ç—å CSS –Ω–∞ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (`transform: translateX(-50%)`) –∏ clamp –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ª–æ–≤–∏–Ω—ã —à–∏—Ä–∏–Ω—ã.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** EdgeTooltip –≤—Å–µ–≥–¥–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∏–¥–∏–º –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö viewport.

---

### 2.17 [HIGH] –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: anchor —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤ host rect, –∞ clamp ‚Äî –≤ viewport

**–§–∞–π–ª—ã:** anchor: [`simulator-ui/v2/src/composables/useSimulatorApp.ts`](simulator-ui/v2/src/composables/useSimulatorApp.ts:1331), clamp: [`simulator-ui/v2/src/components/EdgeDetailPopup.vue`](simulator-ui/v2/src/components/EdgeDetailPopup.vue:41)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –Ø–∫–æ—Ä—å –¥–ª—è popup –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ host/container –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞), –∞ clamping –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –¥—Ä—É–≥–æ–π (viewport `innerWidth/innerHeight`). –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ—Ç—Å—Ç—É–ø–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —Å–∫—Ä–æ–ª–ª–∞, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è layout —ç—Ç–æ –¥–∞—ë—Ç —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–º–µ—â–µ–Ω–∏–µ: popup –º–æ–∂–µ—Ç ¬´—É–ª–µ—Ç–∞—Ç—å¬ª –æ—Ç —Ä–µ–±—Ä–∞ –∏/–∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ clamp-–∏—Ç—å—Å—è.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü—Ä–∏–≤–µ—Å—Ç–∏ anchor –∏ clamping –∫ **–æ–¥–Ω–æ–π** —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:
- –ª–∏–±–æ —Ö—Ä–∞–Ω–∏—Ç—å anchor –≤ viewport-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, clientX/clientY),
- –ª–∏–±–æ clamp-–∏—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–º–µ—Ä–æ–≤ –∏ origin —Ç–æ–≥–æ –∂–µ host rect, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã—á–∏—Å–ª–µ–Ω anchor.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** EdgeDetailPopup —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ä—è–¥–æ–º —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ä–µ–±—Ä–æ–º –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏.

---

### 2.18 [MEDIUM] –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è `''` vs `null/undefined` –ª–æ–º–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ¬´‚Äî¬ª

**–§–∞–π–ª—ã:** snapshot mapping: [`simulator-ui/v2/src/composables/useInteractMode.ts`](simulator-ui/v2/src/composables/useInteractMode.ts:266); —Ä–µ–Ω–¥–µ—Ä —á–µ—Ä–µ–∑ `??`: [`simulator-ui/v2/src/components/EdgeDetailPopup.vue`](simulator-ui/v2/src/components/EdgeDetailPopup.vue:125), [`simulator-ui/v2/src/components/TrustlineManagementPanel.vue`](simulator-ui/v2/src/components/TrustlineManagementPanel.vue:280)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å, –∏–Ω–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∫ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ `''`, –∞ –∏–Ω–æ–≥–¥–∞ –∫–∞–∫ `null/undefined`. –í —à–∞–±–ª–æ–Ω–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è nullish-coalescing (`value ?? '‚Äî'`), –∫–æ—Ç–æ—Ä—ã–π **–Ω–µ** –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç ¬´‚Äî¬ª –¥–ª—è `''`. –í –∏—Ç–æ–≥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ ¬´‚Äî¬ª.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –µ–¥–∏–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å–º. ¬ß3.11):
- –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–∞–ø–ø–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–≤–æ–¥–∏—Ç—å `''` (–∏ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –ø—Ä–æ–±–µ–ª–æ–≤) –∫ `null`,
- –∏/–∏–ª–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `value ? value : '‚Äî'` / `String(value).trim()` –≤–º–µ—Å—Ç–æ `??`).

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä ¬´‚Äî¬ª –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ –¥–ª—è –≤—Å–µ—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

---

### 2.19 [MEDIUM] NodeCardOverlay –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ flow –∏–∑ ActionBar

**–§–∞–π–ª:** [`simulator-ui/v2/src/components/SimulatorAppRoot.vue`](simulator-ui/v2/src/components/SimulatorAppRoot.vue:523)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°—Ü–µ–Ω–∞—Ä–∏–π ¬´NodeCard –æ—Ç–∫—Ä—ã—Ç ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—ã–π flow —á–µ—Ä–µ–∑ ActionBar (start*Flow)¬ª –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ NodeCardOverlay. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ NodeCardOverlay –∏ –ø–∞–Ω–µ–ª–∏ —Ç–µ–∫—É—â–µ–≥–æ flow: —Ñ–æ—Ä–º–∞–ª—å–Ω–æ —ç—Ç–æ –¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –æ–≤–µ—Ä–ª–µ—è –±–µ–∑ –æ–±—â–µ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–µ–Ω–∏—è.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í–≤–µ—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª–æ overlay stack (—Å–º. ¬ß3.10) –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ `startPaymentFlow`/`startTrustlineFlow`/`startClearingFlow` –∑–∞–∫—Ä—ã–≤–∞—é—Ç NodeCardOverlay (–∏ –¥—Ä—É–≥–∏–µ –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—â–∏–µ –æ–≤–µ—Ä–ª–µ–∏), –ª–∏–±–æ –ø–µ—Ä–µ–≤–æ–¥—è—Ç UI –≤ —Å—Ç—Ä–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ¬´–æ–¥–Ω–æ –æ–∫–Ω–æ¬ª.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ª—é–±–æ–≥–æ flow UI –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –Ω–∞–±–æ—Ä—É –≤–∏–¥–∏–º—ã—Ö –æ–∫–æ–Ω.

---

### 2.20 [MEDIUM] –°–µ–º–∞–Ω—Ç–∏–∫–∞ `interactTrustlinesLoading` —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `busy`

**–§–∞–π–ª:** [`simulator-ui/v2/src/components/SimulatorAppRoot.vue`](simulator-ui/v2/src/components/SimulatorAppRoot.vue:609)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è/prop —Å –∏–º–µ–Ω–µ–º `interactTrustlinesLoading` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –æ–±—â–∏–π ¬´–∑–∞–Ω—è—Ç/–Ω–µ–ª—å–∑—è –Ω–∞–∂–∏–º–∞—Ç—å¬ª —Ñ–ª–∞–≥, —Ç–æ –µ—Å—Ç—å –ø–æ —Å–º—ã—Å–ª—É —Ä–∞–≤–Ω–∞ `busy` (–∏–ª–∏ `busyUi`), –∞ –Ω–µ —É–∑–∫–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é ¬´—Ç–æ–ª—å–∫–æ trustlines –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è¬ª. –≠—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç wiring, —á—Ç–µ–Ω–∏–µ –∫–æ–¥–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ (—Å–º. —Ç–∞–∫–∂–µ ¬ß2.14).

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ–Ω—è—Ç–∏—è (—Å–º. ¬ß3.10/¬ß3.11):
- `interactBusy` (–æ–±—â–∏–π busy FSM/–æ–ø–µ—Ä–∞—Ü–∏–π),
- `trustlinesLoading` (–∑–∞–≥—Ä—É–∑–∫–∞/—Ä–µ—Ñ—Ä–µ—à trustlines).
–ò –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å/–ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ–¥ —è–≤–Ω–æ –≤—ã—Ä–∞–∂–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É disable UI –∏ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–π.

---

### 2.21 [LOW] UX/tech-debt: –∞—Ä–±–∏—Ç—Ä–∞–∂ ESC –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏—è –æ–≤–µ—Ä–ª–µ–µ–≤ –±–µ–∑ —è–≤–Ω–æ–≥–æ —Å—Ç–µ–∫–∞

**–§–∞–π–ª:** [`simulator-ui/v2/src/components/SimulatorAppRoot.vue`](simulator-ui/v2/src/components/SimulatorAppRoot.vue:208)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ ESC –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã UI –ø–æ –Ω–∞–±–æ—Ä—É —É—Å–ª–æ–≤–∏–π, –Ω–æ –±–µ–∑ —è–≤–Ω–æ–π –º–æ–¥–µ–ª–∏ ¬´—Å—Ç–µ–∫–∞ –æ–≤–µ—Ä–ª–µ–µ–≤¬ª. –ü—Ä–∏ —É—Å–ª–æ–∂–Ω–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ –æ–∫–æ–Ω: NodeCard, popup, –ø–∞–Ω–µ–ª–∏, —Ç–æ—Å—Ç—ã, –¥–µ–≤-–æ–≤–µ—Ä–ª–µ–π) –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ä–∏—Å–∫ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –∏ ¬´–ø—Ä–æ–±—Ä–æ—Å–∞¬ª ESC –Ω–µ —Ç—É–¥–∞.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í–≤–µ—Å—Ç–∏ —è–≤–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç/—Å—Ç–µ–∫ –æ–≤–µ—Ä–ª–µ–µ–≤ (—Å–º. ¬ß3.10): –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –∏ –µ–¥–∏–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤—ã–±–æ—Ä–∞ ¬´—á—Ç–æ –∑–∞–∫—Ä—ã—Ç—å –ø–µ—Ä–≤—ã–º¬ª.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ESC —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ, –≤ –æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ –¥–ª—è –≤—Å–µ—Ö –æ–∫–æ–Ω.

---

## 3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

### 3.1 –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å edgeDetailAnchor –≤ FSM-—Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–§–∞–π–ª—ã –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã:** `useInteractMode.ts`, `SimulatorAppRoot.vue`, `EdgeDetailPopup.vue`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–µ–π—á–∞—Å `edgeDetailAnchor` –∂–∏–≤—ë—Ç –≤ `useSimulatorApp.ts` –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç `InteractState`. –û–Ω —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ñ–∞–∑–µ `editing-trustline`.

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:**

1. –î–æ–±–∞–≤–∏—Ç—å –≤ `InteractState`:

```typescript
export type InteractState = {
  phase: InteractPhase
  fromPid: string | null
  toPid: string | null
  selectedEdgeKey: string | null
  error: string | null
  lastClearing: SimulatorActionClearingRealResponse | null
  edgeAnchor: { x: number; y: number } | null  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
}
```

2. –í `selectEdge(edgeKey, anchor?)` ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å:

```typescript
function selectEdge(edgeKey: string, anchor?: { x: number; y: number }) {
  state.selectedEdgeKey = edgeKey
  state.edgeAnchor = anchor ?? null
  // ... rest
}
```

3. –í `cancel()` / `resetToIdle()` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å:

```typescript
function resetToIdle() {
  state.phase = 'idle'
  state.fromPid = null
  state.toPid = null
  state.selectedEdgeKey = null
  state.edgeAnchor = null  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
  state.error = null
}
```

4. –£–±—Ä–∞—Ç—å `edgeDetailAnchor` –∏–∑ `SimulatorAppRoot.vue`.

**–í—ã–∏–≥—Ä—ã—à:** –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –±–∞–≥ 2.2 (stale anchor), —É–ø—Ä–æ—â–∞–µ—Ç –æ—Ç–ª–∞–¥–∫—É (–≤—Å—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ), —É—Å—Ç—Ä–∞–Ω—è–µ—Ç coupling –º–µ–∂–¥—É SimulatorAppRoot –∏ EdgeDetailPopup.

---

### 3.2 –†–∞–∑–¥–µ–ª–∏—Ç—å useInteractMode.ts –Ω–∞ —Å–ª–æ–∏

**–§–∞–π–ª:** `simulator-ui/v2/src/composables/useInteractMode.ts` (791 —Å—Ç—Ä–æ–∫)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç FSM-–ª–æ–≥–∏–∫—É, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (participants/trustlines —Å TTL), –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (runBusy, epoch) –∏ history log.

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è:**

```
useInteractMode.ts (791 —Å—Ç—Ä–æ–∫)
   ‚îú‚îÄ‚îÄ useInteractFSM.ts        ‚Äî —á–∏—Å—Ç—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π (~200 —Å—Ç—Ä–æ–∫)
   ‚îú‚îÄ‚îÄ useInteractDataCache.ts  ‚Äî participants + trustlines —Å freshness tracking (~250 —Å—Ç—Ä–æ–∫)
   ‚îú‚îÄ‚îÄ useInteractHistory.ts    ‚Äî history log —Å pushHistory/entries (~100 —Å—Ç—Ä–æ–∫)
   ‚îî‚îÄ‚îÄ useInteractMode.ts       ‚Äî –∫–æ–º–ø–æ–∑–∏—Ü–∏—è: FSM + cache + history + runBusy (~250 —Å—Ç—Ä–æ–∫)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** LOW ‚Äî —ç—Ç–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞. –î–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è issues.

---

### 3.3 Guard –¥–ª—è double-click –≤ picking-—Ñ–∞–∑–∞—Ö (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∞ –≤ –ø. 2.4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å –µ–¥–∏–Ω—ã–π computed `isPickingPhase` –≤ `useInteractMode.ts`:

```typescript
const isPickingPhase = computed(() => state.phase.startsWith('picking-'))
```

–ò —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ `useSimulatorApp.ts` –∏ `useCanvasInteractions.ts`.

---

### 3.4 –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

–û–ø–∏—Å–∞–Ω–æ –≤ –ø. 2.6. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ computed-—Å–≤–æ–π—Å—Ç–≤–∞ `effectiveData` –≤ `TrustlineManagementPanel.vue`, –∫–æ—Ç–æ—Ä–æ–µ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ fetched trustlines —Å fallback –Ω–∞ snapshot props. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –ò –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, –ò –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

---

### 3.5 –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å dropdown ¬´Existing¬ª –≤ TrustlineManagementPanel

**–§–∞–π–ª:** `simulator-ui/v2/src/components/TrustlineManagementPanel.vue:258-275`

**–û–ø–∏—Å–∞–Ω–∏–µ:** Dropdown ¬´Existing¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ –∫–æ–≥–¥–∞ –µ—Å—Ç—å trustlines, –≤–∫–ª—é—á–∞—è —Ñ–∞–∑—É `isPickFrom`. –≠—Ç–æ –¥–∞—ë—Ç shortcut (–ø–µ—Ä–µ–ø—Ä—ã–≥–Ω—É—Ç—å –≤ editing) –Ω–æ –Ω–µ–æ—á–µ–≤–∏–¥–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å dropdown ¬´Existing¬ª —Ç–æ–ª—å–∫–æ –≤ —Ñ–∞–∑–∞—Ö `isCreate || isEdit`:

```html
<div v-if="(isCreate || isEdit) && trustlinesSorted.length > 0" class="ds-field">
  <label for="tl-pick">Existing</label>
  <select id="tl-pick" ...>
```

---

### 3.6 –ï–¥–∏–Ω—ã–π —Å–ª–æ—Ç –¥–ª—è interact-–ø–∞–Ω–µ–ª–µ–π (—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ visual overlap)

**–§–∞–π–ª—ã:** `SimulatorAppRoot.vue`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –¢—Ä–∏ interact-–ø–∞–Ω–µ–ª–∏ (ManualPaymentPanel, TrustlineManagementPanel, ClearingPanel) —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ `<Transition>` –±–ª–æ–∫–∏ –≤ –æ–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ (right: 12px, top: 110px). –ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–π —Å–º–µ–Ω–µ —Ñ–∞–∑ ‚Äî –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ (¬ß2.11).

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å —Ç—Ä–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –±–ª–æ–∫–∞ –Ω–∞ –µ–¥–∏–Ω—ã–π computed-driven —Å–ª–æ—Ç:

```html
<Transition name="panel-slide" mode="out-in">
  <ManualPaymentPanel v-if="activePanelType === 'payment'" key="payment" ... />
  <TrustlineManagementPanel v-else-if="activePanelType === 'trustline'" key="trustline" ... />
  <ClearingPanel v-else-if="activePanelType === 'clearing'" key="clearing" ... />
</Transition>
```

–ì–¥–µ:
```typescript
const activePanelType = computed<'payment' | 'trustline' | 'clearing' | null>(() => {
  const p = interactPhase.value
  if (p.includes('payment')) return 'payment'
  if (p.includes('trustline')) return 'trustline'
  if (p.includes('clearing')) return 'clearing'
  return null
})
```

**–í—ã–∏–≥—Ä—ã—à:** Vue `mode="out-in"` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—ã—Ö–æ–¥—è—â–∞—è –ø–∞–Ω–µ–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–π–¥—ë—Ç –ø–µ—Ä–µ–¥ –ø–æ—è–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–π. –ù–µ—Ç –Ω–∞–ª–æ–∂–µ–Ω–∏–π.

---

### 3.7 –†–∞–∑–Ω–µ—Å—Ç–∏ z-index overlay-—Å–ª–æ—ë–≤ ErrorToast vs. HistoryLog

**–§–∞–π–ª—ã:** `ErrorToast.vue`, `SimulatorAppRoot.vue`

**–û–ø–∏—Å–∞–Ω–∏–µ:** ErrorToast (`z-index: 200`) –∏ HistoryLog (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `ds-ov-bottom`, –Ω–µ—Ç —è–≤–Ω–æ–≥–æ z-index) –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ `bottom: 68px`. 

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ:** –í—ã–Ω–µ—Å—Ç–∏ ErrorToast –∏ HistoryLog –≤ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ, –Ω–µ–∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏:
- HistoryLog: `bottom: 130px; right: 12px` (–Ω–∞–¥ BottomBar, –Ω–∏–∂–µ –ø–∞–Ω–µ–ª–µ–π)
- ErrorToast: `bottom: 68px; left: 50%` (—Ç–µ–∫—É—â–µ–µ) ‚Äî –û–ö, –Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å `top: auto; bottom: calc(100% - ...)` –ø—Ä–∏–≤—è–∑–∫—É –∫ BottomBar.

---

### 3.8 –î–æ–±–∞–≤–∏—Ç—å prop `interactBusy` –≤ NodeCardOverlay

**–§–∞–π–ª—ã:** `NodeCardOverlay.vue`, `SimulatorAppRoot.vue`

**–û–ø–∏—Å–∞–Ω–∏–µ:** Interact-–∫–Ω–æ–ø–∫–∏ –≤ NodeCard (Send Payment, New Trustline) –Ω–µ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è –ø—Ä–∏ `busy=true` (¬ß2.14).

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ:** 
1. –î–æ–±–∞–≤–∏—Ç—å prop `interactBusy?: boolean` –≤ NodeCardOverlay
2. –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –∏–∑ SimulatorAppRoot: `:interact-busy="isInteractUi ? interact.mode.busy.value : false"`
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `:disabled="interactBusy"` –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö

---

### 3.9 –í–≤–µ—Å—Ç–∏ z-index tokens –∏ –µ–¥–∏–Ω—É—é —à–∫–∞–ª—É –¥–ª—è –≤—Å–µ—Ö overlay-—Å–ª–æ—ë–≤

**–§–∞–π–ª—ã –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã:** CSS design-system + App-level CSS (—Å–º. ¬ß2.15)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–µ–π—á–∞—Å z-index –∑–∞–¥–∞—ë—Ç—Å—è —Ç–æ—á–µ—á–Ω–æ –∏ –ª–æ–∫–∞–ª—å–Ω–æ (—á–∞—Å—Ç–∏—á–Ω–æ –≤ design system, —á–∞—Å—Ç–∏—á–Ω–æ –≤ app-—Å—Ç–∏–ª—è—Ö), –∏–∑-–∑–∞ —á–µ–≥–æ –ø–æ—è–≤–ª—è—é—Ç—Å—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã (–Ω–∞–ø—Ä. world labels –ø–æ–≤–µ—Ä—Ö –æ–∫–æ–Ω ‚Äî ¬ß2.15). –ù—É–∂–Ω–∞ –µ–¥–∏–Ω–∞—è –º–æ–¥–µ–ª—å —É—Ä–æ–≤–Ω–µ–π.

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ:**
1) –í–≤–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω—ã (CSS custom properties –∏–ª–∏ –¥–∏–∑–∞–π–Ω-—Ç–æ–∫–µ–Ω—ã) –¥–ª—è —É—Ä–æ–≤–Ω–µ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
--z-base: 0
--z-bar: 30
--z-topbar: 40
--z-panel: 70
--z-tooltip: 80
--z-dev: 90
--z-alert: 200
```

2) –ü—Ä–∏–≤—è–∑–∞—Ç—å –≤—Å–µ overlay-–∫–ª–∞—Å—Å—ã –∏ app-specific —Å–ª–æ–∏ (–≤–∫–ª—é—á–∞—è world labels) –∫ —ç—Ç–∏–º —Ç–æ–∫–µ–Ω–∞–º.

**–í—ã–∏–≥—Ä—ã—à:** –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è; –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ –Ω–µ –ª–æ–º–∞—é—Ç –¥—Ä—É–≥–∏–µ –æ–∫–Ω–∞.

---

### 3.10 Overlay stack: –ø—Ä–∞–≤–∏–ª–æ –æ–¥–Ω–æ –æ–∫–Ω–æ –∏–ª–∏ —è–≤–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è

**–§–∞–π–ª—ã –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã:** `SimulatorAppRoot.vue` wiring, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã overlay-–æ–∫–æ–Ω

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–µ–π—á–∞—Å —á–∞—Å—Ç—å –æ–∫–æ–Ω –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ FSM, —á–∞—Å—Ç—å ‚Äî —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–µ `setOpen(false)` –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö, —á–∞—Å—Ç—å ‚Äî –≤–æ–æ–±—â–µ –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ (—Å–º. ¬ß2.19, ¬ß2.21). –ù—É–∂–Ω–æ —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ:** –≤—ã–±—Ä–∞—Ç—å –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –ø–æ–¥—Ö–æ–¥–æ–≤:

1) **–ü—Ä–∞–≤–∏–ª–æ –æ–¥–Ω–æ –æ–∫–Ω–æ**: –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ª—é–±–æ–≥–æ flow/–æ—Ç–∫—Ä—ã—Ç–∏–∏ popup –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—â–∏–µ –æ–≤–µ—Ä–ª–µ–∏ (NodeCard, –¥—Ä—É–≥–∏–µ popups, –ø–∞–Ω–µ–ª–∏), –æ—Å—Ç–∞—ë—Ç—Å—è –æ–¥–∏–Ω ¬´–∞–∫—Ç–∏–≤–Ω—ã–π¬ª overlay-–∫–æ–Ω—Ç–µ–∫—Å—Ç.
2) **–Ø–≤–Ω—ã–π —Å—Ç–µ–∫**: –¥–æ–ø—É—Å–∫–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–≤–µ—Ä–ª–µ–µ–≤, –Ω–æ –≤–≤–æ–¥–∏–º –ø–æ—Ä—è–¥–æ–∫: –∫—Ç–æ –Ω–∞–¥ –∫–µ–º, –∫—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ ESC/Cancel –ø–µ—Ä–≤—ã–º, –∫–∞–∫–∏–µ –ø–∞—Ä—ã –¥–æ–ø—É—Å—Ç–∏–º—ã.

**–í—ã–∏–≥—Ä—ã—à:** –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–ª–æ–∂–µ–Ω–∏—è (–æ—Å–æ–±–µ–Ω–Ω–æ ActionBar ‚Üí startFlow –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–º NodeCard).

---

### 3.11 –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π: –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–û–ø–∏—Å–∞–Ω–∏–µ:** UI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä ¬´‚Äî¬ª, –Ω–æ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∫ `null/undefined` –∏ –∫–∞–∫ `''`. –ë–µ–∑ –µ–¥–∏–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –≤–æ–∑–Ω–∏–∫–∞—é—Ç ¬´–ø—É—Å—Ç—ã–µ¬ª –∑–Ω–∞—á–µ–Ω–∏—è –≤ UI (¬ß2.18).

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ:**
1) –í–≤–µ—Å—Ç–∏ —É—Ç–∏–ª–∏—Ç—É/–ø—Ä–∞–≤–∏–ª–æ: `emptyStringToNull` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥) –¥–ª—è –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å.
2) –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ **–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º** (–µ—Å–ª–∏ –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è `0`).
3) –ù–∞ —É—Ä–æ–≤–Ω–µ —à–∞–±–ª–æ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π helper –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä `renderValueOrDash`).

**–í—ã–∏–≥—Ä—ã—à:** –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π UI, –º–µ–Ω—å—à–µ —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ —à–∞–±–ª–æ–Ω–∞—Ö.

---

### 3.12 –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å clamp-–ª–æ–≥–∏–∫—É –¥–ª—è popup –∏ tooltip (—à–∏—Ä–∏–Ω–∞/–≤—ã—Å–æ—Ç–∞/–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ–±–ª–µ–º—ã clamping –ø—Ä–æ—è–≤–ª—è—é—Ç—Å—è –∫–∞–∫ –≤ popup (¬ß2.5, ¬ß2.17), —Ç–∞–∫ –∏ –≤ tooltip (¬ß2.16). –ù—É–∂–µ–Ω –µ–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫:
- —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (viewport vs host rect),
- —É—á—ë—Ç—É —Ä–∞–∑–º–µ—Ä–æ–≤ —ç–ª–µ–º–µ–Ω—Ç–∞,
- –ø–∞–¥–¥–∏–Ω–≥–∞–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∑–æ–Ω–∞–º.

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ:** –í—ã–¥–µ–ª–∏—Ç—å –æ–±—â–∏–π helper/composable (–∏–ª–∏ –æ–±—â—É—é —Ñ—É–Ω–∫—Ü–∏—é) –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è overlay-—ç–ª–µ–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç:
- anchor,
- bounds (viewport –∏–ª–∏ host rect),
- —Ä–∞–∑–º–µ—Ä—ã overlay (–∏–∑ –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏–ª–∏ min-size),
- padding.

**–í—ã–∏–≥—Ä—ã—à:** –û–¥–Ω–æ –º–µ—Å—Ç–æ –¥–ª—è –ª–æ–≥–∏–∫–∏ clamp; –º–µ–Ω—å—à–µ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–æ–≤ –º–µ–∂–¥—É tooltip –∏ popup.

---

## 4. TODO Checklist

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: CRITICAL (–¥–æ —Ä–µ–ª–∏–∑–∞)

- [x] **REF-1:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è anchor –≤ FSM-—Å–æ—Å—Ç–æ—è–Ω–∏–µ (`edgeAnchor` –≤ `InteractState`) (¬ß3.1) ‚Äî *—Å–∏—Å—Ç–µ–º–Ω–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç FIX-2 –∏ FIX-9*
- [x] **FIX-14:** z-index: world labels / floating layers –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å –æ–∫–Ω–∞/–ø–∞–Ω–µ–ª–∏ (¬ß2.15)
- [x] **FIX-16:** –ü—Ä–∏–≤–µ—Å—Ç–∏ anchor –∏ clamp –∫ –æ–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (host rect vs viewport) –¥–ª—è EdgeDetailPopup (¬ß2.17)
- [x] **FIX-1:** EdgeDetailPopup ‚Äî —É–¥–∞–ª–∏—Ç—å –º—ë—Ä—Ç–≤—ã–π `v-if` —Å `popup__grid` (¬ß2.1)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: HIGH (–≤ –±–ª–∏–∂–∞–π—à–µ–º —Å–ø—Ä–∏–Ω—Ç–µ)

- [x] **FIX-9:** (–ï—Å–ª–∏ REF-1 –Ω–µ —Å–¥–µ–ª–∞–Ω) edgeDetailAnchor ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –ø—Ä–∏ cancel/ESC/idle (¬ß2.9)
- [x] **FIX-2:** (–ï—Å–ª–∏ REF-1 –Ω–µ —Å–¥–µ–ª–∞–Ω) SimulatorAppRoot ‚Äî —Å–±—Ä–æ—Å–∏—Ç—å `edgeDetailAnchor` –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏–∑ NodeCard (¬ß2.2)
- [x] **FIX-5:** EdgeDetailPopup ‚Äî —É—á–µ—Å—Ç—å —à–∏—Ä–∏–Ω—É –ø–æ–ø–∞–ø–∞ –≤ clamping (¬ß2.5)
- [x] **FIX-15:** EdgeTooltip ‚Äî clamp —Å —É—á—ë—Ç–æ–º —à–∏—Ä–∏–Ω—ã/—Ä–∞–∑–º–µ—Ä–∞ —Ç—É–ª—Ç–∏–ø–∞ (¬ß2.16)
- [x] **FIX-4:** useSimulatorApp ‚Äî guard double-click –≤ picking-—Ñ–∞–∑–∞—Ö (¬ß2.4)
- [x] **FIX-3:** TrustlineManagementPanel ‚Äî watcher –Ω–∞ `from+to` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `newLimit` (¬ß2.3)
- [x] **FIX-18:** –ó–∞–∫—Ä—ã–≤–∞—Ç—å NodeCardOverlay –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ flow –∏–∑ ActionBar; —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å overlay stack (¬ß2.19, ¬ß3.10)
- [x] **NEW-1:** useInteractMode ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ refreshParticipants() + refreshTrustlines() –≤ selectTrustline() (¬ß6.1/NEW-1)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: MEDIUM (backlog)

- [x] **FIX-6:** TrustlineManagementPanel ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `effectiveUsed` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (¬ß2.6)
- [x] **FIX-7:** ActionBar ‚Äî –º—è–≥–∫–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ flow (¬ß2.7)
- [x] **FIX-8:** EdgeDetailPopup ‚Äî `flex-wrap` + `gap` –¥–ª—è `popup__actions` (¬ß2.8)
- [x] **FIX-10:** –†–∞–∑–Ω–µ—Å—Ç–∏ ErrorToast –∏ InteractHistoryLog –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ (¬ß2.10)
- [x] **FIX-11:** –ü–∞–Ω–µ–ª–∏: —É—Å—Ç—Ä–∞–Ω–∏—Ç—å visual overlap –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–π —Å–º–µ–Ω–µ —Ñ–∞–∑ (¬ß2.11)
- [x] **FIX-17:** –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è `''` vs `null/undefined` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ¬´‚Äî¬ª (¬ß2.18)
- [x] **FIX-19:** –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å/—Ä–∞–∑–¥–µ–ª–∏—Ç—å `interactTrustlinesLoading` –Ω–∞ `interactBusy` –∏ `trustlinesLoading` (busy vs loading) (¬ß2.20)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: LOW (polish / UX)

- [x] **FIX-12:** TrustlineManagementPanel ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å dropdown ¬´Existing¬ª –≤ picking-from (¬ß2.13)
- [x] **FIX-13:** NodeCardOverlay ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `interactBusy` prop –¥–ª—è disable –∫–Ω–æ–ø–æ–∫ (¬ß2.14)
- [x] **FIX-20:** ESC: —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç/—Å—Ç–µ–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–≤–µ—Ä–ª–µ–µ–≤ (UX/tech-debt) (¬ß2.21, ¬ß3.10)
- [x] **NEW-2:** –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å hardcoded z-index –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –Ω–∞ CSS-—Ç–æ–∫–µ–Ω—ã --ds-z-* (¬ß6.1/NEW-2) ‚Äî –æ—Å—Ç–∞–ª—Å—è `TopBar.vue:489` Admin dropdown
- [x] **NEW-3:** SimulatorAppRoot ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å backend-fetched trustlines –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è interactSelectedLink, —Å fallback –Ω–∞ snapshot (¬ß6.1/NEW-3)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: LOW (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥)

- [x] **REF-2:** –†–∞–∑–¥–µ–ª–∏—Ç—å `useInteractMode.ts` –Ω–∞ —Å–ª–æ–∏: FSM / DataCache / History (¬ß3.2)
- [x] **REF-3:** –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `isPickingPhase` computed –∏–∑ `useInteractMode.ts` (¬ß3.3)
- [x] **REF-4:** –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö `effectiveData` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (¬ß3.4)
- [x] **REF-5:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å dropdown ¬´Existing¬ª —Ñ–∞–∑–∞–º–∏ `isCreate || isEdit` (¬ß3.5)
- [x] **REF-6:** –ï–¥–∏–Ω—ã–π `<Transition mode="out-in">` —Å–ª–æ—Ç –¥–ª—è —Ç—Ä—ë—Ö interact-–ø–∞–Ω–µ–ª–µ–π (¬ß3.6) ‚Äî *—É—Å—Ç—Ä–∞–Ω—è–µ—Ç FIX-11*
- [x] **REF-7:** –†–∞–∑–Ω–µ—Å—Ç–∏ z-index overlay-—Å–ª–æ—ë–≤ ErrorToast / HistoryLog (¬ß3.7) ‚Äî *—É—Å—Ç—Ä–∞–Ω—è–µ—Ç FIX-10*
- [x] **REF-8:** –î–æ–±–∞–≤–∏—Ç—å prop `interactBusy` –≤ NodeCardOverlay (¬ß3.8) ‚Äî *—É—Å—Ç—Ä–∞–Ω—è–µ—Ç FIX-13*
- [x] **REF-9:** –í–≤–µ—Å—Ç–∏ z-index tokens –∏ –µ–¥–∏–Ω—É—é —à–∫–∞–ª—É –¥–ª—è overlay-—Å–ª–æ—ë–≤ (¬ß3.9) ‚Äî *—É—Å—Ç—Ä–∞–Ω—è–µ—Ç FIX-14*
- [x] **REF-10:** –§–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å overlay stack (–æ–¥–Ω–æ –æ–∫–Ω–æ –∏–ª–∏ —è–≤–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫) (¬ß3.10) ‚Äî *—É—Å—Ç—Ä–∞–Ω—è–µ—Ç FIX-18, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç FIX-20*
- [x] **REF-11:** –ï–¥–∏–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π (¬ß3.11) ‚Äî *—É—Å—Ç—Ä–∞–Ω—è–µ—Ç FIX-17*
- [x] **REF-12:** –û–±—â–∏–π helper –¥–ª—è clamp –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è popup/tooltip (¬ß3.12) ‚Äî *–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç FIX-5, FIX-15, FIX-16*

---

## 6. –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| ID | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª/—Å—Ç—Ä–æ–∫–∞ |
|---|---|---|---|
| FIX-1 | CRITICAL | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | EdgeDetailPopup.vue:123 |
| FIX-2 | HIGH | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (—á–µ—Ä–µ–∑ REF-1) | useInteractMode.ts:580 |
| FIX-3 | HIGH | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | TrustlineManagementPanel.vue:59 |
| FIX-4 | HIGH | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | useSimulatorApp.ts:1343 |
| FIX-5 | HIGH | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | overlayPosition.ts |
| FIX-6 | MEDIUM | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | TrustlineManagementPanel.vue:88 |
| FIX-7 | MEDIUM | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (–≤–∞—Ä–∏–∞–Ω—Ç –ê) | ActionBar.vue:46 |
| FIX-8 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | EdgeDetailPopup.vue:192 |
| FIX-9 | HIGH | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (—á–µ—Ä–µ–∑ REF-1) | useInteractMode.ts:258 |
| FIX-10 | MEDIUM | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | SimulatorAppRoot.vue:701 |
| FIX-11 | MEDIUM | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (—á–µ—Ä–µ–∑ REF-6) | SimulatorAppRoot.vue:543 |
| FIX-12 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | TrustlineManagementPanel.vue:279 |
| FIX-13 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | NodeCardOverlay.vue:32 |
| FIX-14 | CRITICAL | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | App.css:22 ‚Äî --ds-z-world-labels: 20 |
| FIX-15 | HIGH | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | useEdgeTooltip.ts:56 |
| FIX-16 | CRITICAL | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | overlayPosition.ts:22 |
| FIX-17 | MEDIUM | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | valueFormat.ts:11 |
| FIX-18 | HIGH | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | SimulatorAppRoot.vue:432 |
| FIX-19 | MEDIUM | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | SimulatorAppRoot.vue:621 |
| FIX-20 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | `escOverlayStack.ts:25`, `SimulatorAppRoot.vue:214` |
| REF-1 | CRITICAL | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | useInteractMode.ts:34, EdgAnchor –≤ InteractState |
| REF-2 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | DataCache ‚úì, History ‚úì, FSM ‚úì ‚Äî `useInteractFSM.ts` (341 —Å—Ç—Ä–æ–∫–∞, —á–∏—Å—Ç—ã–µ FSM-–ø–µ—Ä–µ—Ö–æ–¥—ã) |
| REF-3 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | useInteractMode.ts:103 |
| REF-4 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | TrustlineManagementPanel.vue:76 |
| REF-5 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | —Å–º. FIX-12 |
| REF-6 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | SimulatorAppRoot.vue:543 |
| REF-7 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | —Å–º. FIX-10 |
| REF-8 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | NodeCardOverlay.vue:32 |
| REF-9 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | App.css:17 + designSystem.overlays.css:24 |
| REF-10 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | `escOverlayStack.ts:25`, `SimulatorAppRoot.vue:214` |
| REF-11 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | valueFormat.ts + emptyToNull/renderOrDash |
| REF-12 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | utils/overlayPosition.ts:11 |
| NEW-1 | HIGH | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | `useInteractMode.ts:362` |
| NEW-2 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | TopBar.vue:489 |
| NEW-3 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | `SimulatorAppRoot.vue:255` |
| ¬ß7.1 | MEDIUM | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | useEdgeTooltip.ts:43 + test:34 |
| ¬ß7.2 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | useInteractFSM.ts:31,:105 |
| ¬ß7.3 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | NodeCardOverlay.vue:173 |
| ¬ß7.4 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | TrustlineManagementPanel.vue:271,:291 |
| ¬ß7.5 | LOW | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | useInteractFSM.test.ts, useEdgeTooltip.test.ts:33 |

### 6.1 –ù–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### NEW-1 [WARNING] selectTrustline() –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫—ç—à –ø—Ä–∏ –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ NodeCard ‚Äî ‚úÖ –†–ï–®–ï–ù–û –≤ useInteractMode.ts:362
**–§–∞–π–ª:** `simulator-ui/v2/src/composables/useInteractMode.ts` (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 573)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚Äî `selectTrustline()` —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç `refreshParticipants()` –∏ `refreshTrustlines()`.

–ü—É—Ç—å `onInteractEditTrustline` (–∏–∑ NodeCard) –≤—ã–∑—ã–≤–∞–µ—Ç `selectTrustline(fromPid, toPid)`, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É –≤ `editing-trustline` –±–µ–∑ –≤—ã–∑–æ–≤–∞ `refreshTrustlines()` –∏ `refreshParticipants()`. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —ç—Ç–æ–≥–æ, `selectEdge()` –≤—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±–∞ refresh. –ï—Å–ª–∏ –∫—ç—à —É—Å—Ç–∞—Ä–µ–ª (TTL 30 —Å–µ–∫), TrustlineManagementPanel –æ—Ç–æ–±—Ä–∞–∑–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞, –∞ –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```typescript
function selectTrustline(fromPid: string, toPid: string) {
  if (busyRef.value) return
  clearError()
  state.fromPid = String(fromPid ?? '').trim() || null
  state.toPid = String(toPid ?? '').trim() || null
  if (!state.fromPid || !state.toPid) return
  state.selectedEdgeKey = keyEdge(state.fromPid, state.toPid)
  state.edgeAnchor = null
  state.phase = 'editing-trustline'
  // –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ selectEdge():
  void refreshParticipants()
  void refreshTrustlines()
}
```

#### NEW-2 [LOW] Hardcoded z-index –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö ‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ–∫–µ–Ω—ã ‚Äî ‚úÖ –†–ï–®–ï–ù–û –≤ TopBar.vue:489
**–§–∞–π–ª—ã:**
- `simulator-ui/v2/src/components/EdgeDetailPopup.vue:168` ‚Äî `z-index: 42` ‚úÖ
- `simulator-ui/v2/src/components/ErrorToast.vue:73` ‚Äî `z-index: 200` ‚úÖ
- `simulator-ui/v2/src/components/TopBar.vue:399` ‚Äî `z-index: 60` ‚úÖ
- `simulator-ui/v2/src/components/TopBar.vue:489` ‚Äî Admin dropdown inline `z-index: 60` ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–®–ï–ù–û ‚Äî –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ `--ds-z-*` —Ç–æ–∫–µ–Ω—ã, –≤–∫–ª—é—á–∞—è `TopBar.vue:489` (Admin dropdown).

REF-9 —Å–æ–∑–¥–∞–ª —Å–∏—Å—Ç–µ–º—É —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `--ds-z-*` –≤ `App.css` –∏ –ø—Ä–∏–º–µ–Ω–∏–ª –∏—Ö –≤ `designSystem.overlays.css`, –Ω–æ scoped-—Å—Ç–∏–ª–∏ —Å–∞–º–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```css
/* EdgeDetailPopup.vue */ z-index: var(--ds-z-panel, 42);
/* ErrorToast.vue */ z-index: var(--ds-z-alert, 200);
/* TopBar.vue */ z-index: var(--ds-z-inset, 60);
```

#### NEW-3 [LOW] –†–∞–∑–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è EdgeDetailPopup vs TrustlineManagementPanel ‚Äî ‚úÖ –†–ï–®–ï–ù–û –≤ SimulatorAppRoot.vue:255
**–§–∞–π–ª:** `simulator-ui/v2/src/components/SimulatorAppRoot.vue:264`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚Äî `interactSelectedLink` —Ç–µ–ø–µ—Ä—å –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç backend-fetched trustlines —Å fallback –Ω–∞ snapshot.

`interactSelectedLink` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ `state.snapshot`. `EdgeDetailPopup` –ø–æ–ª—É—á–∞–µ—Ç `used/limit/available` –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞. `TrustlineManagementPanel` —á–µ—Ä–µ–∑ `effectiveData` –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–µ—Ç backend-fetched –¥–∞–Ω–Ω—ã–µ. –ü—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –ø–æ–∫–∞–∑–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

**–¢—Ä–µ–±—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `interact.mode.trustlines.value` –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è `interactSelectedLink`, —Å fallback –Ω–∞ snapshot.

---

## 7. –ó–∞–º–µ—á–∞–Ω–∏—è, —Ä–∏—Å–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∞–º

### 7.1 –†–∏—Å–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: tooltip layout thrash

**–§–∞–π–ª:** `simulator-ui/v2/src/composables/useEdgeTooltip.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:** Tooltip –∏–∑–º–µ—Ä—è–µ—Ç DOM-—Ä–∞–∑–º–µ—Ä—ã —á–µ—Ä–µ–∑ `querySelector` + `getBoundingClientRect()` –≤–Ω—É—Ç—Ä–∏ computed (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π pointermove / —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π –∞–ø–¥–µ–π—Ç). –≠—Ç–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ layout thrash ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π reflow –Ω–∞ –∫–∞–∂–¥–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –•—Ä–∞–Ω–∏—Ç—å `overlaySize` –≤ `ref` –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ mount/–∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (—á–µ—Ä–µ–∑ `ResizeObserver`).
- –õ–∏–±–æ –∏–∑–º–µ—Ä—è—Ç—å 1 —Ä–∞–∑ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ (–∏–ª–∏ —á–µ—Ä–µ–∑ `requestAnimationFrame`), –∞ –Ω–µ –Ω–∞ –∫–∞–∂–¥—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç —Å—Ç–∏–ª—è.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** MEDIUM (–∑–∞–º–µ—Ç–Ω–æ –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö pointermove –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö).

‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û: overlaySize –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –≤ ref, DOM query —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–∫–∞–∑–µ (useEdgeTooltip.ts:43). –†–µ–≥—Ä–µ—Å—Å-—Ç–µ—Å—Ç: useEdgeTooltip.test.ts:34.

---

### 7.2 –ö–æ–Ω—Ç—Ä–∞–∫—Ç: `lastClearing` –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ `resetToIdle()`

**–§–∞–π–ª:** `simulator-ui/v2/src/composables/interact/useInteractFSM.ts`

**–ù–∞–±–ª—é–¥–µ–Ω–∏–µ:** `resetToIdle()` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç `edgeAnchor`, `fromPid`, `toPid` –∏ —Ç.–¥., –Ω–æ **–Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç `lastClearing`**. –ï—Å–ª–∏ —ç—Ç–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî ¬´idle –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å lastClearing¬ª –∫–∞–∫ –ø–∞–º—è—Ç—å –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –∫–ª–∏—Ä–∏–Ω–≥–µ ‚Äî —Å—Ç–æ–∏—Ç —è–≤–Ω–æ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ª–æ–≥–∏—á–Ω–µ–µ —á–∏—Å—Ç–∏—Ç—å `lastClearing` –≤ `resetToIdle()` –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –Ø–≤–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ FSM (–∏–ª–∏ –≤ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç): ¬´`lastClearing` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ idle –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ ‚Äî –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤ BottomBar / HistoryLog¬ª.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** LOW (—Ä–∏—Å–∫ UX-–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è, –Ω–µ –±–∞–≥).

‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û: JSDoc-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏ inline-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω—ã (useInteractFSM.ts:31, :105).

---

### 7.3 NodeCardOverlay: —á–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è –±–µ–∑ `renderOrDash`

**–§–∞–π–ª:** `simulator-ui/v2/src/components/NodeCardOverlay.vue`

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ø–∏—Å–æ–∫ trustlines –≤ NodeCard —Ä–µ–Ω–¥–µ—Ä–∏—Ç —á–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è (`used`, `limit`, `available`) –±–µ–∑ `renderOrDash()`, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `EdgeDetailPopup.vue` –∏ `TrustlineManagementPanel.vue`. –†–∏—Å–∫: `null` –∏–ª–∏ `''` –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞–∫ –ø—É—Å—Ç–æ—Ç–∞ –∏–ª–∏ ¬´0¬ª ‚Äî —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º UI.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã—Ä–æ–≤–Ω—è—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –ø—Ä–∏–º–µ–Ω–∏—Ç—å `renderOrDash()` –∏–∑ `valueFormat.ts` –∫ —á–∏—Å–ª–æ–≤—ã–º –ø–æ–ª—è–º TL –≤ NodeCard.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** LOW (–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å UX, –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–∞–≥).

‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û: renderOrDash() –ø—Ä–∏–º–µ–Ω—ë–Ω –∫ —á–∏—Å–ª–æ–≤—ã–º –ø–æ–ª—è–º TL –≤ NodeCardOverlay.vue:173.

---

### 7.4 TrustlineManagementPanel: UX-—Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤–µ—Ç–≤–ª–µ–Ω–∏–π create/edit/picking

**–§–∞–π–ª:** `simulator-ui/v2/src/components/TrustlineManagementPanel.vue`

**–ù–∞–±–ª—é–¥–µ–Ω–∏–µ:** –ü–∞–Ω–µ–ª—å —Å—Ç–∞–ª–∞ –∑–∞–º–µ—Ç–Ω–æ —É–º–Ω–µ–µ (effectiveUsed / –≤–∞–ª–∏–¥–∞—Ü–∏—è / —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è), –Ω–æ UX-–≤–µ—Ç–≤–ª–µ–Ω–∏—è ¬´—á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ create / edit / picking¬ª —Ç–µ–ø–µ—Ä—å –¥–æ–≤–æ–ª—å–Ω–æ —Å–ª–æ–∂–Ω—ã–µ. –†–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–π ‚Äî —Å–∫–æ—Ä–µ–µ UX-–ª–æ–≥–∏—á–µ—Å–∫–∏–π, —á–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ—á–µ–≤–∏–¥–Ω–æ, –ø–æ—á–µ–º—É –∏—Å—á–µ–∑–ª–∏ —Å–µ–ª–µ–∫—Ç—ã From/To –∏–ª–∏ –ø–æ—á–µ–º—É ¬´Existing¬ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `title` / `disabled`-hint –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤–µ–∑–¥–µ, –≥–¥–µ —Å–µ–ª–µ–∫—Ç —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ tooltip/hint –≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** LOW (UX-polish).

‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û: title-–∞—Ç—Ä–∏–±—É—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞ To-—Å–µ–ª–µ–∫—Ç –∏ dropdown Existing –≤ TrustlineManagementPanel.vue:271, :291.

---

### 7.5 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∞–º (—Ä–µ–≥—Ä–µ—Å—Å-–∑–∞—â–∏—Ç–∞)

–°–ª–µ–¥—É—é—â–∏–µ –¥–≤–∞ –∫–µ–π—Å–∞ –¥–æ–±–∞–≤—è—Ç –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≥–∞—Ä–∞–Ω—Ç–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:

1. **¬´cancel() –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ—á–∏—â–∞–µ—Ç edgeAnchor –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç EdgeDetailPopup¬ª** ‚Äî —Å–∫–≤–æ–∑–Ω–æ–π —Ç–µ—Å—Ç –Ω–∞ —Å–≤—è–∑–∫—É FSM + UI:
   - –ö–ª–∏–∫ –Ω–∞ —Ä–µ–±—Ä–æ ‚Üí anchor —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, popup –æ—Ç–∫—Ä—ã—Ç
   - `cancel()` ‚Üí anchor = null, popup –∑–∞–∫—Ä—ã—Ç
   - –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ª—é–±—É—é –¥—Ä—É–≥—É—é —Ñ–∞–∑—É ‚Üí popup –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

2. **¬´Tooltip clamp –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö DOM-–∏–∑–º–µ—Ä–µ–Ω–∏–π –ø—Ä–∏ –Ω–µ–ø–æ–¥–≤–∏–∂–Ω–æ–º –∫—É—Ä—Å–æ—Ä–µ¬ª** ‚Äî —Ç–µ—Å—Ç –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≥–æ, —á—Ç–æ —Ä–∞—Å—á—ë—Ç –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ DOM query:
   - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: smoke-—Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–Ω–µ—Ç –ª–∏—à–Ω–∏—Ö reflow –ø—Ä–∏ mousemove –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞).

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** LOW (nice-to-have, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–ª–∏–∑).

‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û: useInteractFSM.test.ts (cancel+edgeAnchor+lastClearing), useEdgeTooltip.test.ts:33 (overlay size caching). –í—Å–µ 6 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç.

---

## 5. –ú–∞—Ç—Ä–∏—Ü–∞ –æ–∫–æ–Ω: –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ z-index

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü–æ–∑–∏—Ü–∏—è CSS | z-index | –í–∏–¥–∏–º–æ—Å—Ç—å (—Ñ–∞–∑—ã FSM) | –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ |
|---|---|---|---|---|
| TopBar | `top:12px; left:12px; right:12px` | 40 | –í—Å–µ–≥–¥–∞ (–µ—Å–ª–∏ !bootLoading) | ‚Äî |
| ActionBar | `.ds-ov-bar` (inline layout) | ‚Äî | –í—Å–µ–≥–¥–∞ (interact mode) | ‚Äî |
| SystemBalanceBar | `.ds-ov-bar` (inline layout) | ‚Äî | interact + autoRun | ‚Äî |
| ManualPaymentPanel | `right:12px; top:110px` | 42 | picking-payment-*, confirm-payment | ‚ö† —Å TrustlinePanel –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–π —Å–º–µ–Ω–µ (¬ß2.11) |
| TrustlineManagementPanel | `right:18px; top:dynamic` | 42 | picking-trustline-*, confirm-tl-create, editing-tl | ‚ö† —Å ManualPaymentPanel (¬ß2.11) |
| ClearingPanel | `right:12px; top:110px` | 42 | confirm-clearing, clearing-preview, clearing-running | ‚Äî |
| EdgeDetailPopup | `left/top: anchor-based` | 42 | editing-trustline && anchor | ‚ö† —Å—Ç–µ–π–ª anchor (¬ß2.2, ¬ß2.9) |
| NodeCardOverlay | `left/top: node-based` | 42 | dblclick –Ω–∞ —É–∑–µ–ª (–Ω–µ –≤ picking) | ‚ö† —Å panels –ø—Ä–∏ dblclick –≤ picking (¬ß2.4) |
| LabelsOverlayLayers (world labels / floating layers) | app-specific | (—Å–º. CSS) | –≤—Å–µ–≥–¥–∞ (–Ω–∞–¥ canvas) | ‚ö† –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –æ–∫–Ω–∞ –ø—Ä–∏ –Ω–µ–≤–µ—Ä–Ω–æ–º z-index (¬ß2.15) |
| EdgeTooltip | `left/top: pointer-based` | 55 | hover –Ω–∞ —Ä–µ–±—Ä–æ | ‚Äî |
| ErrorToast | `bottom:68px; left:50%` | 200 | interact + error | ‚ö† —Å HistoryLog (¬ß2.10) |
| InteractHistoryLog | `bottom:68px; right:12px` | 30 (ds-ov-bottom) | interact + history.length > 0 | ‚ö† —Å ErrorToast (¬ß2.10) |
| BottomBar | `bottom:12px; left:50%` | 30 | –í—Å–µ–≥–¥–∞ | ‚Äî |
| DevPerfOverlay | `right:12px; bottom:12px` | 50 | Dev mode | ‚Äî |

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ z-index:

```
z-index: 200  ErrorToast (alerts ‚Äî –≤—Å–µ–≥–¥–∞ –ø–æ–≤–µ—Ä—Ö)
z-index:  80  EdgeTooltip (transient ‚Äî –±—ã—Å—Ç—Ä–æ —É—Ö–æ–¥–∏—Ç)
z-index:  50  DevPerfOverlay
z-index:  70  Panels + Popups (ManualPayment, Trustline, Clearing, EdgeDetail, NodeCard)
z-index:  60  World labels / floating layers (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∏–∂–µ –æ–∫–æ–Ω) (¬ß2.15)
z-index:  40  TopBar
z-index:  30  BottomBar, HistoryLog
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1) Panels –∏ NodeCard –Ω–∞ –æ–¥–Ω–æ–º z-index (42). –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ FSM –∏ guards –Ω–µ –¥–æ–ø—É—Å–∫–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –¥–≤—É—Ö panels, –Ω–æ –ø—Ä–∏ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö transitions –≤–æ–∑–º–æ–∂–Ω–æ –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ.
2) EdgeDetailPopup –∏ NodeCard —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç (NodeCard –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ editing-trustline), –Ω–æ —Å—Ç–µ–π–ª anchor (¬ß2.9) –∏ —Å—Ç–∞—Ä—Ç flow –∏–∑ ActionBar –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–º NodeCard (¬ß2.19) –Ω–∞—Ä—É—à–∞—é—Ç —ç—Ç—É –≥–∞—Ä–∞–Ω—Ç–∏—é.
3) World labels / floating layers –º–æ–≥—É—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –≤—ã—à–µ –æ–∫–æ–Ω –ø—Ä–∏ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–π —à–∫–∞–ª–µ z-index (¬ß2.15) ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ (¬ß3.9).
